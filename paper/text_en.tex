% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  14pt,
  english,
  a4paper,
]{scrreprt}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Containerization Overview \& Security},
  pdfauthor={Guenfaf Hicham},
  pdflang={en},
  pdfkeywords={Docker, Qemu, kvm, security, SELinux, Containerization, Virtualization},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[top=30mm,right=20mm,left=20mm,bottom=30mm]{geometry}
\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
\lstset{defaultdialect=[5.3]Lua}
\lstset{defaultdialect=[x86masm]Assembler}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\makeatletter
\@ifpackageloaded{subfig}{}{\usepackage{subfig}}
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\captionsetup[subfloat]{margin=0.5em}
\AtBeginDocument{%
\renewcommand*\figurename{Figure}
\renewcommand*\tablename{Table}
}
\AtBeginDocument{%
\renewcommand*\listfigurename{List of Figures}
\renewcommand*\listtablename{List of Tables}
}
\newcommand*\listoflistings\lstlistoflistings
\AtBeginDocument{%
\renewcommand*{\lstlistlistingname}{List of Listings}
}
\makeatother
\ifxetex
  % Load polyglossia as late as possible: uses bidi with RTL langages (e.g. Hebrew, Arabic)
  \usepackage{polyglossia}
  \setmainlanguage[]{english}
\else
  \usepackage[shorthands=off,main=english]{babel}
\fi
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Containerization Overview \& Security\thanks{Author}}
\author{Guenfaf Hicham}
\date{2020-06-06}

\begin{document}
\maketitle
\begin{abstract}
This paper focuses on how to secure containers by using linux open
source virtulization software Qemu/KVM as the main tool along side other
technologies such as SELinux, cgroups to help isolate and harden the
systems even further.
\end{abstract}

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\listoftables
\listoffigures
\hypertarget{chapter-1-general-introduction}{%
\chapter{CHAPTER 1 : General
Introduction}\label{chapter-1-general-introduction}}

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

In todays world digital life is a crucial part for every human being
daily life. Social media networks such as facebook, instagram, twitter
\& linkedin are in a sense vital these days. Further more we have cloud
services providers on the enterprise world such as AWS\footnote{Amazon
  Web Services}, Linode \& Alibaba Cloud amongst others, And this also
includes a heap of online banking \& shopping and much more
\textbf{aaS}\footnote{as a Service} providers, which are all based on
information technology systems and the ability to \textbf{save, secure
\& serve data}.

\leavevmode\hypertarget{bigfive}{}%
\includegraphics[width=0.2\textwidth,height=\textheight]{figures/Amazon-logo.png}
\includegraphics[width=0.2\textwidth,height=\textheight]{figures/Apple_logo.png}
\includegraphics[width=0.2\textwidth,height=\textheight]{figures/Facebook-logo.png}
\includegraphics[width=0.2\textwidth,height=\textheight]{figures/Google-logo.png}
\includegraphics[width=0.14\textwidth,height=\textheight]{figures/Microsoft-logo.png}

The giant technology companies of our modern society also known as the
big five, \textbf{Amazon, Apple, Facebook, Google \& Microsoft} are said
to be in hold of a noteworthy\footnote{Specific data size information
  not available to the public} deal of the global aggregate information
quantity, and it's by no means a straightforward process to effectively
and efficiently manage these huge data mines without the proper
underling \emph{secure, coordinated \& fast} infrastructures. In such
circumstances the ability to handle massive amounts of data flow is
fatal, therefore stability, scalability and reliability is critical
which require a sophisticated near perfection pipelining systems in
every single aspect. Consequently, to achieve this high level of
sophistication, some of the latest bleeding edge technologies in the
field must be without any doubt. That said one of the most valuable arms
that are being used to accomplish this goal is the ``Containerization
technology'', it is one the most important key elements in data centers
all over the globe; however with the latest and greatest comes the worst
in terms of security risks and vulnerabilities that must be coped with.

\begin{quote}
\textbf{``A flaw in the host kernel could allow a process within a
container to break out and take over the system.''}
\end{quote}

Is one way a security researcher described how insecure containers can
potentially be as opposed to good old virtual machines.

\hypertarget{problematic}{%
\section{Problematic}\label{problematic}}

In today's cyber security community it is a fact that Containers and
Containerization in general is still isn't mature enough in a cyber
security aspect to be deployed directly in the absence of any kind of
external security measures, and even with that in place containerization
deployments are still vulnerable to an external sources of threat which
are completely out of their own control.

On the 25th of April 2019 a containerization images database called
``Dockerhub''\footnote{https://hub.docker.com} has been breached by an
unknown attacker as stated in a followup article by
\textbf{hackernews}\footnote{https://news.ycombinator.com} right after
the disclosure,

\begin{quote}
\textbf{" Docker Hub, one of the largest cloud-based library of Docker
container images, has suffered a data breach after an unknown attacker
gained access to the company's single Hub database. "}
\end{quote}

After investigating the incident Dockerhub team reacted as quickly as
possible to prevent any further losses and warned it's users :

\begin{quote}
\textbf{``On Thursday, April 25th, 2019, we discovered unauthorized
access to a single Hub database storing a subset of non-financial user
data. Upon discovery, we acted quickly to intervene and secure the
site.''}
\end{quote}

And regarding the damages caused, the article stated :

\begin{quote}
\textbf{" The breach reportedly exposed sensitive information for nearly
190,000 Hub users (that's less than 5 percent of total users), including
usernames and hashed passwords for a small percentage of the affected
users, as well as Github and Bitbucket tokens for Docker repositories.
"}
\end{quote}

The company didn't give any further information about how it's database
was breached.

This type of \emph{cyber attacks} are in general fatal since they target
a publicly trusted distribution system, responsible for supplying base
images all around the world where it's used in multitude of applications
like for example banking systems, military bases and so on, which will
be under the hacker's control. This is one of many cases that shows how
delicate containerization infrastructure really is.

At this point the major question that we're left with is how to provide
an environment that is risk free for this relatively young technology ?

What are the tools that are on our reach at this moment that are going
to help us mitigate this kind of malicious events in the future ?

\hypertarget{methodology}{%
\section{Methodology}\label{methodology}}

In order to dive deeper \& investigate these questions a variety of
resources has been used alongside some techniques to test and validate
concepts and ideas.

Generally speaking the data in question is mostly \textbf{qualitative},
that is it's based on descriptions and definitions that revolved around
the topic at hand i.e \textbf{``Containerization Security''}, however
the data collection was by no means randomly done, every single bit of
information was deeply analyzed and tested as much as possible in both
hard/software-wise to make sure that it was up to the level of validity
that in my humble opinion is deemed to be acceptable as a set of
standard cyber security best practices.

Every single data source used to build this paper is included at the
\textbf{``Bibliography'' SECTION} of the last \textbf{CHAPTER} on this
paper.

I deem the Linux manual pages i.e the \textbf{``man'' command} as one of
the \& most trustworthy roots of valid and testable data on this topic,
it's certainly checkable on every aspect at every time, unless major
changes will be committed to software at or after the time at which this
paper has been published publicly, therefor every single software
version that was used in this work is included.

\hypertarget{hardware}{%
\subsection{Hardware :}\label{hardware}}

\hypertarget{tbl:Used_Hardware}{}
\begin{longtable}[]{@{}lc@{}}
\caption{\label{tbl:Used_Hardware}Used~Hardware}\tabularnewline
\toprule
Component & Model\tabularnewline
\midrule
\endfirsthead
\toprule
Component & Model\tabularnewline
\midrule
\endhead
LAPTOP & Lenovo Thinkpad X1 Yoga\tabularnewline
RAM & 16 GB\tabularnewline
CPU & i7 6600U\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{software}{%
\subsection{Software :}\label{software}}

\hypertarget{tbl:used_software}{}
\begin{longtable}[]{@{}lc@{}}
\caption{\label{tbl:used_software}Used~Software}\tabularnewline
\toprule
Software & Version\tabularnewline
\midrule
\endfirsthead
\toprule
Software & Version\tabularnewline
\midrule
\endhead
LINUX & Linux pc 5.7.2-arch1-1\tabularnewline
DISTRIBUTION & Archlinux\tabularnewline
QEMU & QEMU emulator version 5.0.0\tabularnewline
LIBVIRT & libvirtd (libvirt) 6.5.0\tabularnewline
VIRTMANAGER & Virtual Machine Manager 2.2.1\tabularnewline
LIBGUESTFS & libguestfs 1.42.0-2\tabularnewline
OPENVSWITCH &\tabularnewline
PFSENSE &\tabularnewline
OPNSENSE &\tabularnewline
DOCKER &\tabularnewline
LXC &\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{objectives}{%
\section{Objectives}\label{objectives}}

\hypertarget{main}{%
\subsection{Main}\label{main}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Understanding the basic concepts about the topic
\item
  Setting up Qemu/kvm virtualizaion host
\item
  Setting up Docker in a virtualizaion environment
\item
  Host Hardening
\item
  Setting up a secure environment for docker containers
\end{enumerate}

\hypertarget{auxiliary}{%
\subsection{Auxiliary}\label{auxiliary}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Making Qemu easier to learn by using a web interface
\item
  Making Docker easier to learn by using a web interface
\item
  Disk image manipulation from the command line
\end{enumerate}

\hypertarget{company}{%
\section{Company}\label{company}}

ARES\footnote{https://www.aresalgerie.com/} Algeria was created in 2003
following the desire to set up the company ARES France on Algerian
territory, the latter was part of one of the best SSII (computer
engineering services company) in France. Starting from late 2008 ARES
Algeria is now a 100\% Algerian company. ARES Algeria is specialized in
the marketing and implementation of integrated IT solutions for
companies and large administrations. It is involved in the integration
of IT services in different sectors on the Algerian market.

ARES Algeria presents an end-to-end solutions portfolio integrating
active and passive equipment, software, and specialized services, for
all infrastructure needs: Virtualization, convergence, and cloud.

They aim at providing support to their clients and future clients in
their digital transformation and to provide innovative solutions in the
modernization of their business solutions. ARES team is a
multidisciplinary, specialized, trained and certified team on the
different technologies that they support. They Also have an in-house
demo platform that is being used to test the different solutions and
present them to their customers.

Check them out at :

\begin{quote}
https://www.aresalgerie.com/
\end{quote}

\hypertarget{chapter-2-concepts}{%
\chapter{CHAPTER 2 : Concepts}\label{chapter-2-concepts}}

\hypertarget{introduction-1}{%
\section{Introduction}\label{introduction-1}}

Arguably a good understanding of any topic is required to achieve any
admirable accomplishment in that particular filed, And in some cases
this involves making the somewhat close concepts distinct from the main
subject of interest.

In that context, containerization is not different it clearly overlaps
with a couple of similar ideas in computer science, Rendering any
attempt to grasp it's notions associated strongly with adjacent
concepts.

Throughout this chapter we'll be exploring what makes containerization
technology standout apart from other similar technology such as
virtualizaion.

\hypertarget{section-i-simulation-emulation}{%
\section{SECTION I : Simulation \&
Emulation}\label{section-i-simulation-emulation}}

\hypertarget{introduction-2}{%
\subsection{Introduction}\label{introduction-2}}

Simulation and Emulation a couple of terms that most of us take for
granted, and are widely used interchangeably thinking they represent the
same idea, but do we really understand what are the fundamental
differences in two of the most fundamental concepts in computer science
?

Let's start with the terminology of a photograph, based on what it is
\textbf{``a grid of pixels on paper or screen''}, it's an emulation
since it captures the functionality that we need as close to reality as
possible i.e how every thing looked at that very moment or time.

However a simulation at the other hand of that same moment would be
achieved by reconstructing the entire scene in a sandboxed environment,
that means atoms, forces. . . etc or at a higher level polygons or 3D
models of the objects, people\ldots{} and so on, of course this wouldn't
look exactly the same as the photograph would, and this is why it
simulates the real thing.

So obviously emulation is used since it does what we need in the most
realistic way \textbf{possible}, so it looks as if we're looking or
using or more generally interacting with real thing.

Nevertheless this is still entirely dependent on the area of interest
where this might not be the same case considering the broad spectrum
where these terms can be used.

\hypertarget{simulation}{%
\subsection{Simulation}\label{simulation}}

\hypertarget{definition}{%
\subsubsection{Definition}\label{definition}}

\begin{quote}
\textbf{``To give or assume the appearance or effect of often with the
intent to deceive.''} Merriam-webster\footnote{https://www.merriam-webster.com}
\end{quote}

Simulating is building a model that can be \emph{manipulated} to answer
a question(s). It is also a model of target system made to dynamically
represent it's behavior under different conditions, it's based on
mathematical models in computer programs.

In general a simulation is an approximation of a system that represents
it's operation over time, it tries to go as deep as possible imitating
the root causes \textbf{key characteristics} of the simulated artifact,
by reconstructing the simulated object in an external environment.

In practice a Simulation is used in case the target system cannot be
operated, since it's under \textbf{active development} e.g \emph{new CPU
architechture, games console\ldots{}} or a \textbf{one-time project}
such as \emph{new hardware, rocket launch tests, dangerous weapon. . .}
or it's merely impossible to do in reality; As well as event predictions
e.g \emph{weather, geology. . .} or any nature related science.

The simulation level of perfection is called the simulation
\textbf{``Fidelity''} level, and it can be one of three levels \emph{{[}
Low, Medium, High {]}}, depending on how close the simulation is to the
target system.

\begin{quote}
Note : In Reality the term Simulation has a wide range of
representations depending on the context it's used under, in this paper
we'll be taking the computer science representation, unless noted
otherways.
\end{quote}

\hypertarget{simulation-background}{%
\subsubsection{Simulation Background}\label{simulation-background}}

Historically Simulation has been used in many science disciplines, this
type of activity mainly started right after \textbf{World War
II}\footnote{1945} and it grew since then to cover a broader range of
sciences like physics, particle physics, fluid dynamics, biology,
virology, sociology and more, architechture for example was and still
using building simulation by making small models using paper before 3d
software\footnote{Such as AutoCAD, 3DS Max, Civil 3D, Revit, Sketchup
  and more} enabled advanced simulation features.

From the Computer Science point of view a simulation is a program that
runs on a computer \& takes as it's input the state and the sum of input
data at time \textbf{``t-1''} of the simulated system in order to
compute the required outputs which are the inputs of the simulated
system which in return gives back the next state in \textbf{``t+1''} and
so on.

\[S_t=s(S_{t-1},\ \sum{i_{t-1}})\]

Where :

\begin{quote}
\emph{s(S, i)} is the state function
\end{quote}

\begin{quote}
\emph{S\textsubscript{t-1}} the old state
\end{quote}

\begin{quote}
\emph{S\textsubscript{t}} the new state
\end{quote}

\begin{quote}
\emph{i}\textsubscript{t-1} the input at \emph{t-1}
\end{quote}

One extremely popular and simple example that is worth noting to learn
about simulations is the simulation/game \textbf{``John Conway Game Of
Life''}\footnote{https://copy.sh/life/} .

\hypertarget{simulation-types}{%
\subsubsection{Simulation Types}\label{simulation-types}}

\hypertarget{software-simulation}{%
\paragraph{Software Simulation}\label{software-simulation}}

\begin{itemize}
\tightlist
\item
  \textbf{Stand Alone :}
\end{itemize}

It's based on single workstation/server, hence this type is overall
focused on low duty simulations.

\begin{itemize}
\tightlist
\item
  \textbf{Distributed :}
\end{itemize}

Also called DIS\footnote{Distributed Interactive Simulation}, it's an
IEEE\footnote{The Institute of Electrical and Electronics Engineers}
standard developed by SISO\footnote{Simulations Interoperability
  Standards Group} Group, DIS is a network protocol that was mainly
developed for military virtual world real time simulations, it uses
PDUs\footnote{Protocol Data Units} to exchange various forms of data
about the 3D battle field for military applications.

One implementation is the Open Source Project \textbf{``open-dis''}
\footnote{open-dis.org} organization, that aims to implement the DIS
protocol in different languages such as \emph{{[}C++, Python,
Java\ldots{]}} and making it available for general public use under the
\textbf{``BSD-2-Clause License''} for most of the implementations.

\begin{itemize}
\tightlist
\item
  \textbf{Parallel :}
\end{itemize}

Supercomputers are used in this type to achieve an in imaginable amount
of FLOPS\footnote{Floating Point Operations Per Second} to simulate
events such as the creation of the universe, protine folding and a lot
of other natural fenomena.

\begin{itemize}
\tightlist
\item
  \textbf{Interoperable :}
\end{itemize}

SaaS (Simulation as a Service) : Simulation as Service is a subtype of
``Software as a Service'' it's an online service that offers
computational power to the client in order to run extremely complex
simulations in their servers or supercomputers, the client interfaces
with the simulation using the SaaS provider web interface ``UI''.
``OnScale'' is SaaS simulation provider.

\hypertarget{hardware-simulation}{%
\paragraph{Hardware Simulation}\label{hardware-simulation}}

On most of the cases hardware simulation is mixed with software
simulation for data analysis. They are often based on VR ( Virtual
Riality ) and/or AR ( Augmented Reality ) technologies for smooth human
interaction with the simulation

This family includes :

\begin{itemize}
\tightlist
\item
  Flight Simulators
\item
  Driving Simulators
\item
  Space Simulators
\end{itemize}

\hypertarget{applications}{%
\subsubsection{Applications :}\label{applications}}

\begin{itemize}
\item
  Scientific models
\item
  Architectural design
\end{itemize}

\includegraphics[width=0.5\textwidth,height=\textheight]{figures/Bridge-weightsim.png}
\includegraphics[width=0.5\textwidth,height=\textheight]{figures/Architecturalsim2.jpg}

\begin{itemize}
\tightlist
\item
  Training and Testing
\end{itemize}

\includegraphics[width=0.6\textwidth,height=\textheight]{figures/Flight-sim.jpg}
\includegraphics[width=0.4\textwidth,height=\textheight]{figures/Driving-sim.png}

\begin{itemize}
\tightlist
\item
  Video Games
\item
  Prototyping \& Testing
\end{itemize}

\includegraphics[width=0.5\textwidth,height=\textheight]{figures/Airplanesim.png}
\includegraphics[width=0.5\textwidth,height=\textheight]{figures/Carsim.png}

\begin{itemize}
\tightlist
\item
  Health care applications
\end{itemize}

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figures/Healthsim.jpg}
\caption{HealthSim}
\end{figure}

\hypertarget{emulation}{%
\subsection{Emulation}\label{emulation}}

\hypertarget{definition-1}{%
\subsubsection{Definition}\label{definition-1}}

To emulate means to be like or beat the emulated object or system, in
it's pure \emph{computer science} sense it describes the ability to make
the \emph{emulated system} run on a different
\textbf{environment/architecture} or hardware as is without
modification, meaning \emph{``faking the original environment''}.

The emulation is a \textbf{software~translation layer} or in other terms
a \emph{``program''} that sets between the \textbf{target and platform}
we want to run and the host operating system which in turn is in control
of the underlying physical hardware. This layer is able to
\textbf{translate} foreign architecture \textbf{instructions} of the
emulated program to instructions that the host CPU can
\textbf{understand} ``is able to execute'' and with that we're able to
emulate another type of hardware that the program is expecting to run on
top of, therefore making a \textbf{high~compatibility~environment} for
the target software to run in.

For instance if a program \emph{natively} runs on system \textbf{X} and
does not run on the system \textbf{Y}, we emulate \textbf{X} in
\textbf{Y} and run the program in the emulation of system \textbf{X}
which is emulated on system \textbf{Y}.

In a lot of cases the emulated software has the ability to considerably
outperform it self on the original hardware in other words it can run
with higher performance, resolution \& stability.

\hypertarget{background}{%
\subsubsection{Background}\label{background}}

Now since Definitions don't always make it clear what emulation actually
is let's take a look at how it all started what is it and how it even
works?

Emulation is done by mimicking the underlying hardware for a given
software to make it run on any environment. The whole idea was initiated
by \textbf{IBM}\footnote{International Business Machines} around 1995 as
the two projects \textbf{YSE}\footnote{Yorktown Simulation Engine} and
\textbf{EVE}\footnote{Engineering Verification Engine} designed for
hardware emulation purposes.

On the software emulation side it was followed by
\textbf{MAME}\footnote{Multi Arcade Machine Emulator} which is an open
source arcade game consoles software emulator , designed by
\emph{Nichola Samorya} Released on the 05th of February of 1997.
Launched first on \textbf{MSDOS} platform and later ported to
\textbf{Unix} like operating systems, it was originally written in
\textbf{C} then ported to \textbf{C++} for better code quality.

Emulators are able emulate a wide variety of hardware such as graphics
cards, CPU architectures, sound cards, chipsets, memory management,
storage technologies and nearly every single hardware and software
combination possible.

\hypertarget{types-of-emulators}{%
\subsubsection{Types of emulators}\label{types-of-emulators}}

Mainly emulation splits into two subsets, Hardware \& Software
emulation. Depending on the emulation requirements one or the other is
used, since every type presents it's own set of advantages and
disadvantages.

\hypertarget{hardware-emulators}{%
\paragraph{Hardware emulators}\label{hardware-emulators}}

The idea is emulating hardware with an equivalent or different more
general purpose hardware, it's mostly used in prototyping \& testing of
under design and construction hardware architectures.

For hardware emulation purposes the following methods are often used :

\begin{itemize}
\tightlist
\item
  \textbf{ASIC :}
\end{itemize}

ASIC\footnote{Application Specific Integrated Circuit}s are a type of
hardware that is made specifically for a particular type of
computational work loads, this means that the performance/power
consumption ratio is really high compared to using other general purpose
hardware.

In General ASICs are being used quit extensively in crypto currency
mining due to it's efficiency.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figures/Asic-chip.jpg}
\caption{ASIC}
\end{figure}

\begin{itemize}
\tightlist
\item
  \textbf{FPGA :}
\end{itemize}

FPGA\footnote{Field Programmable Gate Arrays}s as opposed are general
purpose hardware, in theory they are able to emulate any type or
architecture of ever possible provided that there is enough of them.

FPGAs are basically nothing more that a bunch of digital logic gates
stacked together to form a programmable silicon chip that is able to
mimic any kind of hardware chip that is of an equivalent or lower
complexity.

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth,height=\textheight]{figures/Fpga-chip.png}
\caption{FPGA}
\end{figure}

\hypertarget{software-emulators}{%
\paragraph{Software emulators}\label{software-emulators}}

Software emulators aim at recreating the real life behavior of the
emulated system, with the highest performance possible, this branch
includes :

\begin{itemize}
\tightlist
\item
  \textbf{Video Game Consoles} :
\end{itemize}

\begin{quote}
PCSX2 : Playstation 2 emulator for Pc
\end{quote}

\begin{quote}
Cemu : Wii U emulator for Pc
\end{quote}

\begin{itemize}
\tightlist
\item
  \textbf{Network} :
\end{itemize}

\begin{quote}
Cisco Packet Tracer
\end{quote}

\begin{quote}
GNS3\footnote{Graphical Network Simulator} : Although it's a
\textbf{Simulator} it uses an emulation in the backend to work.
\end{quote}

\begin{quote}
EVE-ng\footnote{Emulated Virtual Environment - Next Generation}
\end{quote}

\begin{itemize}
\tightlist
\item
  \textbf{CPU} :
\end{itemize}

\begin{quote}
QEMU : supports very wide range of architectures
\end{quote}

\begin{quote}
BOCHS : x86 \& x86\_64 instruction set emulator
\end{quote}

\begin{quote}
DOSBOX : x86 Disk Operating System DOS machine
\end{quote}

\begin{itemize}
\tightlist
\item
  \textbf{Operating Systems} :
\end{itemize}

\begin{quote}
WINE\footnote{Wine Is Not an Emulator} : technically WINE is a
compatibility layer for Windows software on linux
\end{quote}

\begin{quote}
Darling : technically Darling is a compatibility layer for MacOS
software on linux
\end{quote}

\begin{quote}
BlueStacks : Android emulator for Pc
\end{quote}

\begin{quote}
Cygwin : Linux based operating system on Windows
\end{quote}

\begin{quote}
WSL\footnote{Windows Subsystem for Linux} : introduced on Windows10, is
linux on windows terminal
\end{quote}

\hypertarget{applications-1}{%
\subsubsection{Applications}\label{applications-1}}

\begin{itemize}
\tightlist
\item
  Running programs that are meant for other hardware Architectures
\item
  Running Multiple Operating Systems on the same hardware
\item
  Running legacy firmware
\end{itemize}

\hypertarget{pros-cons}{%
\subsubsection{Pros \& Cons}\label{pros-cons}}

\begin{itemize}
\item
  \textbf{Pros :}
\item
  Higher \emph{customization} ability
\item
  Keeps old hardware and software \emph{alive}
\item
  Helps in \emph{easing~the~development} process and costs
\item
  Most likely to achieve \emph{higher~performance}
\item
  The sky is the limit on emulation ability
\item
  \textbf{Cons :}
\item
  Slower than real hardware in most cases if \emph{not~optimized}
\item
  Require \emph{high~performance~hardware}
\item
  Possibility of \emph{compatibility~issues}
\item
  Extremely \emph{complicated~development~process}
\item
  Time consuming process
\item
  Possible \emph{legal~issues} in some cases
\end{itemize}

\hypertarget{section-ii-virtualization-containerization}{%
\section{SECTION II : Virtualization \&
Containerization}\label{section-ii-virtualization-containerization}}

\hypertarget{introduction-3}{%
\subsection{Introduction}\label{introduction-3}}

In the near past IT services were deployed straight on top of
\textbf{physical~hardware}, although this approach was significantly
easier it was clearly a waste of resources across the board. Servers
obviously wasn't running at their full performance, \textbf{CPU~\&~RAM}
usage used to be low most of the time, Storage devices weren't being
used in the most efficient way possible let alone the power consumption.
In short computing power is getting wasted.

This situation pushed the engineers to think in a completely different
way to find an more optimized method to address this problem.

As a possible solution for this issue
\textbf{``Virtualization~technology''} was invented and used, by using
this relatively new technology at the time service providers were able
to remarkably reduce \textbf{server~ideling} time, which allowed system
administrators a much higher ability to manage servers, however
\emph{``something~was~still~not~right,~with this~concept''} the
engineers thought, or at least it wasn't a complete solution yet. They
went back to the design board to figure out what is it that is wrong and
how to go about solving it.

After a deep analysis of the issue they figured, why spinning multiple
VMs of the same base operating system for every single service/software
we want to run why not using only a \textbf{single~instance} of the same
operating system and somehow manage to split it \textbf{internally} to
allow for multiple software to run without interfering with each other,
and that is what we call \textbf{``Containerization~technology''}.

So how each of \textbf{``Virtualization''} \&
\textbf{``Containerization''} technologies work and what are the
essential differences amongst the two ? This it the question that we'll
discuss in this SECTION.

\hypertarget{virtualization}{%
\subsection{Virtualization}\label{virtualization}}

\hypertarget{definition-2}{%
\subsubsection{Definition}\label{definition-2}}

Multiplexing resources Pure virtualization is about
\textbf{resource~management} and \textbf{process~isolation}, it
basically works by splitting resources of a single or multiple
\textbf{host~machine(s)} into multiple \textbf{software~isolated~guests}
which are called \textbf{``Virtual Machines''} or \textbf{VM}s for
short, these guests must be of the same architecture as the host they
are virtualized on top of.

It leverages the CPU \textbf{virtualization~instrucion~set} to run guest
instructions directly on the CPU, by taking advantage of
\textbf{accelerated} virtualization, virtual machines are able to
achieve high levels of performance, in case were the host's CPU lacks
virtualization compatibility, \textbf{paravirtualization} is used which
results in much lower performance.

Is a technology that allows for running multiple operating systems on
the same host using the same hardware, it uses emulation in order
emulate hardware as virtual hardware on the host which will appear as
physical in the guest operating systems, the key feature of
virtualization is the ability to run multiple operating systems under
the same hypervisor.

\hypertarget{background-1}{%
\subsubsection{Background}\label{background-1}}

Virtualization appeared in the 1960s related to the relatively popular
multiuser ``mainframes'' such as \textbf{``IBM~S/360,~S/370''} and
\textbf{``DEC~PDP-10''}, Obviously at the time user isolation was an
essential requirement due to the fundamental nature of the mainframes.
At that point in time Virtualization was completely disregarded due the
development of \textbf{MULTIX \& UNIX} and
\textbf{UNIX~like~Operating~Systems}\footnote{BSD, Linux} in general
which solved the users/processes isolation \& separation concerns by
implementing time-sharing.

In 1974 \textbf{``Popek~and~Goldberg''} wrote a paper at \emph{Harvard
University} called \textbf{``Formal Requirements for Virtualizable Third
Generation Architectures''}, which laid down the
\emph{fundamental~Virtualization~Principles} stating the folowing :

\begin{quote}
First the efficiency principle, \emph{" All innocuous instructions are
executed by the hardware directly, with no intervention at all on the
part of the control program. "}
\end{quote}

Specifying that the virtual machine instructions must run directly on
the hardware without any intervention from the VMM\footnote{Virtual
  Machine Monitor : is the equivalent of a hypervisor} which is
essential to achieve the same performance as running directly on top of
physical hardware.

\begin{quote}
Secondly the Resource Control principle, \emph{" It must be impossible
for that arbitrary program to affect the system resources, i.e.~memory,
available to it; the allocator of the control program is to be invoked
upon any attempt. "}
\end{quote}

That states that the VMM must be in full control of the virtualized
resources so that the virtual machine code is not able to alter any
aspect outside of the environment allocated to it by the VMM and any
malicious instruction is trapped otherways.

\begin{quote}
Thirdly the equivalence principle, \emph{" Any program K executing with
a control program resident, with two possible exceptions, performs in a
manner indistinguishable from the case when the control program did not
exist and K had whatever freedom of access to privileged instructions
that the programmer had intended. "}
\end{quote}

That is the virtual machines should have identical ``equivalent''
behavior running inside of the VMM as if it's running on bare-metal
directly.

These principles became the blueprint of Virtualization capable
hardware, however this didn't happen until few years later.

Forwarding to 1990s server owners found themselves in a major hardware
under-use in other words ``waste'', since different software wasn't
compatible with different vendors hardware which forced them to use a
server for every task or service they are running, this caused a lot of
servers to run for what was virtually nothing, which caused the real
virtualization takeoff and thereof cloud-computing ecosystems.

\hypertarget{components}{%
\subsubsection{Components}\label{components}}

\hypertarget{host}{%
\paragraph{Host}\label{host}}

The physical hardware that the hypervisor is installed on top of in
order to split and manage its resources among the Virtual Machines,
notice that the total sum of the guest and the hypervisor resource
consumption of a given type cannot under any circumstance exceed the
available physical resources of the same type on the host.

The Host is in charge of providing resources such as CPU, Memory, Buses,
Storage, Networking, external I/O, to the Virtual Machines through the
hypervisor which abstracts these resources from the guests most of the
time.

\hypertarget{hypervisor}{%
\paragraph{Hypervisor}\label{hypervisor}}

The Hypervisor or VMM as it is usually called, is in essence the
software layer that sits on top of the host's physical hardware and is
responsible for the physical resources separation \& allocation to
virtual resources from the Host as needed to Guests, it's also
responsible for the Creation, Monitoring \& management of the Virtual
Machines it hypervises.

\hypertarget{hypervisor-types}{%
\subparagraph*{hypervisor types :}\label{hypervisor-types}}
\addcontentsline{toc}{subparagraph}{hypervisor types :}

\begin{itemize}
\tightlist
\item
  \textbf{Type 1 Hypervisor :}
\end{itemize}

Also known as Bare-metal or Native Hypervisor, it's the first type VMM
since it's installed directly on the host hardware, it is a specialized
operating system made from the ground up for virtualization purposes.
Type 1 renders the host machine a Virtualization platform only so in
most of the cases it's not possible to be used for other intents, this
makes Bare-metal hypervisors an extremly high performance hypervisors
compared to the what other types has to offer. They're generaly
lightwight operating systems, with bare bones user interface ( UI ) for
setting up the essential parameters such as server networking " ip ,
netmask, dns, domain name ``, Administrator Credentials, updates,
management Console''shell".

\begin{figure}
\hypertarget{fig:type1hyp}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/Type-1-Hyp.png}
\caption{Type~1~Hypervisors~Diagram}\label{fig:type1hyp}
}
\end{figure}

Some of the type one hypervisors include :

\hypertarget{tbl:type1_hyp}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:type1_hyp}First Type Hypervisors}\tabularnewline
\toprule
\begin{minipage}[b]{0.25\columnwidth}\raggedright
Hypervisor\strut
\end{minipage} & \begin{minipage}[b]{0.30\columnwidth}\raggedright
Base Operating System\strut
\end{minipage} & \begin{minipage}[b]{0.22\columnwidth}\raggedright
Licenseing\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.25\columnwidth}\raggedright
Hypervisor\strut
\end{minipage} & \begin{minipage}[b]{0.30\columnwidth}\raggedright
Base Operating System\strut
\end{minipage} & \begin{minipage}[b]{0.22\columnwidth}\raggedright
Licenseing\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.25\columnwidth}\raggedright
KVM\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
Linux\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Free Software\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
VMM/VMD\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
OpenBSD\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Free\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
Bhyve\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
FreeBSD\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Free\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
OpenVZ\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Free\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
Xen Project\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
Linux/BSD\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Payed Software\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
Citrix Hypervisor\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Payed\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
XCP-ng\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Free\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
Proxmox\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Free\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
Oracle VM\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Payed\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
Microsoft Hyper-V\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
Windows\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Payed\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.25\columnwidth}\raggedright
VMware ESX/ESXi\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright
Custom/Propreitary\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
Payed\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{itemize}
\tightlist
\item
  \textbf{Type 2 Hypervisor:}
\end{itemize}

Also called \textbf{Hosted Hypervisor} this Type is installed on top of
perinstalled operating system on the host machine, hence the ``Type 2''
it's also called a Hosted Hypervisor. The nature of being installed on
top of an preexisting operating system causes this type to have
relatively lower performance because of the multiple layers of software
which introduces a significant deal of latency in execution.

Being an application which Graphical User Interface in most of the
cases, They provide an easier way to manage the Virtualization
environment, this is specificaly usefull for unexperienced individuals
and small to medium sized companies.

As far as features goes, this type obviously lacks a lot of what
enterprise grade hypervisors has to offer

\begin{figure}
\hypertarget{fig:type2hyp}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/Type-2-Hyp.png}
\caption{Type~2~Hypervisors~Diagram}\label{fig:type2hyp}
}
\end{figure}

Some type 2 hypervisors :

\hypertarget{tbl:type2_hyp}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:type2_hyp}Second Type Hypervisors}\tabularnewline
\toprule
\begin{minipage}[b]{0.27\columnwidth}\raggedright
Hypervisor\strut
\end{minipage} & \begin{minipage}[b]{0.29\columnwidth}\raggedright
Operating System\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.27\columnwidth}\raggedright
Hypervisor\strut
\end{minipage} & \begin{minipage}[b]{0.29\columnwidth}\raggedright
Operating System\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.27\columnwidth}\raggedright
Gnome Boxes\strut
\end{minipage} & \begin{minipage}[t]{0.29\columnwidth}\raggedright
Linux\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
Oracle VirtualBox\strut
\end{minipage} & \begin{minipage}[t]{0.29\columnwidth}\raggedright
Linux/Windows\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
VMware Workstation\strut
\end{minipage} & \begin{minipage}[t]{0.29\columnwidth}\raggedright
Linux/Windows/Macos\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
VMware Player\strut
\end{minipage} & \begin{minipage}[t]{0.29\columnwidth}\raggedright
Linux/Windows/Macos\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.27\columnwidth}\raggedright
VMware Fusion\strut
\end{minipage} & \begin{minipage}[t]{0.29\columnwidth}\raggedright
Linux/Windows/Macos\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{itemize}
\tightlist
\item
  \textbf{Diffrences :}
\end{itemize}

The comparison diagram bellow shows clearly that type 2 hypervisors have
one additional layer as opposed to type 1 hypervisors.

\begin{figure}
\hypertarget{fig:type1vs2}{%
\centering
\includegraphics[width=1.05\textwidth,height=\textheight]{figures/Type-1vs2-Hyp.png}
\caption{Type~1~\&~2~Comparison}\label{fig:type1vs2}
}
\end{figure}

This makes type 2 hypervisors slower by definition since all system
calls have to go through the Operating System then to the Kernel before
it reaches the hardware which will certainly showup as a performance hit
at the guests level, This overhead is unavoidable in that case.

\begin{itemize}
\tightlist
\item
  \textbf{Hybrid Hypervisor :}
\end{itemize}

Hybrid hypervisors is a type that is capable of running on both
secnarios. That is, straight on hardware without any underling Operating
System, Or installed alongside other software on top of a presetup
Operating System.

The only Hypervisor that falles ender this category is
\textbf{Qemu/KVM}.

\hypertarget{guest}{%
\paragraph{Guest}\label{guest}}

Also called Virtual Machine or VM for short, is the operating system or
software that is installed and managed by the hypervisor each VM has its
own resources , in enterprise environments each VM represents a service

\hypertarget{types}{%
\subsubsection{Types}\label{types}}

Virtualization splits to three main branches

\begin{itemize}
\tightlist
\item
  \textbf{Para-Virtualization :}
\end{itemize}

In This type of virtualization the guest operating system must be
modified in order to be virtualized hence why it's also called
\textbf{``OS Assisted''} Virtualization, these modifications are drivers
or patches that must be applied at the kernel level on the guest OS.

This technology was developed by XEN and it used to be called
paravirt-ops, \textbf{Para-} is a Greek word that stands for ``with''
``alongside'', which explains the principle of paravirtualization.

These patches replaces the most sensitive not virtualizable instructions
in the guest ISA\footnote{Instruction Set Architecture}, this opens a
communication channel between the guest and the hypervisor, since the
guests are running on \textbf{Ring 3} least privilege mode they are not
capable of executing hardware \texttt{syscalls} directly, for instance
some hardware instructions or \texttt{syscalls} such as memory
management, interrupt handler are replaced with it's equivalent
hypervisor calls or \texttt{hypercalls} so that they're traped by the
VMM, the hypervisor then executes the guest's instructions on the
hardware then returns the results to the source VM.

\begin{figure}
\hypertarget{fig:paravirt}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/paravirtualization_diagram.png}
\caption{paravirtualization}\label{fig:paravirt}
}
\end{figure}

A clear down side of paravirtualization is that is can't run unmodified
guests such as old operating systems or completely new ones until
support is added.

\begin{itemize}
\tightlist
\item
  \textbf{Full-Virtualization :}
\end{itemize}

The guests under full virtualization run completely unmodified, which
means the guests are not aware that they are being virtualized at all,
this is achieved by running the guest instructions using
\textbf{Binary~Translation} on run-time for privileged not virtualizable
instruction along side \textbf{Shadow~Page~Table} for memory management,
however userspace instructions run directly on the hardware.

Binary translation was developed by VMware in order to make x86 platform
virtualizable, which it was said to be impossible back then.

This works by Trapping \& Translating the guest's high privilege
instructions at the guest run-time, so that if the guest issued a high
privileged \texttt{syscall} it will be trapped and Translated to a
sequence of low privilege instructions by The VMM so that it can be
executed on the virtual hardware.

\begin{figure}
\hypertarget{fig:fullvirt}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/fullvirtualization_diagram.png}
\caption{fullvirtualization}\label{fig:fullvirt}
}
\end{figure}

It uses an instruction cache to keep the most recent translated
instructions in order to improve performance at the cost of memory usage

As shown in the figure above fig.~\ref{fig:fullvirt} this model uses the
processor ring protection modes to isolate/protect the virtualization
components from any tampering or malicious behavior.

\begin{itemize}
\tightlist
\item
  \textbf{Hardware Assisted Virtualization :}
\end{itemize}

Here the hardware is responsible for catching the sensitive instructions
and redirecting them back to the Hypervisor, in this case any privileged
instruction will flag a hardware interrupt. This support is actually
built into the processors them selfs rather than being a software
implementation, its also called hardware acceleration, it uses both
Intel VT-x \& AMD AMD-V hardware virtualization interface and
IOMMU\footnote{Input Output Memory Management Unit} for handling IO
virtualization and Intel EPT\footnote{Extended Page Tables} \& AMD
RVI\footnote{Rapid Virtualization Indexing} for fast TLB\footnote{Translation
  Lookaside Buffer} and memory access.

\begin{figure}
\hypertarget{fig:hardvirt}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/hardwarevirtualization_diagram.png}
\caption{harware~assisted~virtualization}\label{fig:hardvirt}
}
\end{figure}

The Hypervisor runs on privilege mode bellow Ring 0 which is called
\emph{Ring 0P Privileged root mode}, Since the hardware it self is
assisting the hypervisor. While the guests run on a mode called
\emph{Ring 0D De-privileged non-root mode} on top of the Hypervisor's
privilege mode, which is theoretically Ring 0 as far as the guest OS is
concerned.

\begin{itemize}
\tightlist
\item
  \textbf{Virtualization Differences Table :}
\end{itemize}

\begin{longtable}[]{@{}ll@{}}
\toprule
\begin{minipage}[b]{0.29\columnwidth}\raggedright
Method\strut
\end{minipage} & \begin{minipage}[b]{0.47\columnwidth}\raggedright
Mode\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.29\columnwidth}\raggedright
Para-Virtualization\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Guest Modification, Hypercalls\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.29\columnwidth}\raggedright
Full-Virtualization\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
Binary Translation at run time\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.29\columnwidth}\raggedright
Hardware-Assisted\strut
\end{minipage} & \begin{minipage}[t]{0.47\columnwidth}\raggedright
VT-x \& AMD-V ISA Ring0P \& Ring 0D\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{features}{%
\subsubsection{Features}\label{features}}

\begin{itemize}
\tightlist
\item
  \textbf{Snapshots :}
\end{itemize}

The ability to save the current state of the guest to the system
storage, this functionality helps in case a guest is facing a failure
after an update or a malicious software installation in which case the
system administrator will have the ability to restore a clean known
working Snapshot.

\begin{itemize}
\tightlist
\item
  \textbf{Migration :}
\end{itemize}

Migration adds the ability to move guest virtual machines from a host to
another, and it can be done in three different ways

\begin{itemize}
\tightlist
\item
  \textbf{cold} : Completely shuting down the guest VM rendering it
  unoperational during the migration process
\item
  \textbf{warm} : Pausing the VM while migrating, this will cause a
  minor down time
\item
  \textbf{live} : No down time at all, the VM is migrated without any
  interruption in the services it's running
\end{itemize}

\hypertarget{pros-cons-1}{%
\subsubsection{Pros \& Cons :}\label{pros-cons-1}}

\begin{itemize}
\item
  \textbf{Pros :}
\item
  High Security
\item
  High Isolation
\item
  Stability
\item
  Compatibility
\item
  \textbf{Cons :}
\item
  High resource usage
\item
  High boot times in general
\item
  Slightly harder to maintain
\end{itemize}

\hypertarget{containerization}{%
\subsection{Containerization}\label{containerization}}

\hypertarget{introduction-4}{%
\subsubsection{Introduction}\label{introduction-4}}

Instead of overloading the infrastructure with heaps of duplicate and
mostly identical virtual machines, the tech industry have gone the
containerization path. Obviously this move is driven by the need for an
faster, lighter wight, manageable \& maintainable and hopefully secure
development, distribution \& deployment model.

As the virtualization little brother containerization have become the
defacto standard for software development all around the tech industry,
at this point this relatively new technology is changing how software is
being written and distributed for ever.

Next we'll see what exactly it is? How it works? And what we can use it
for?

\hypertarget{definition-3}{%
\subsubsection{Definition}\label{definition-3}}

A container is striped out version of an application or operating system
typically Unix-like,the most important aspect of a container is that it
has no kernel as opposed to virtual machines that comes packed. This
makes the containers that run on the same host, kernel/architecture
dependent on that host.

Containerization \textbf{engines} or \textbf{container runtime} that
play the role of the hypervisors.

By default they support only one application per container, Containers
are immutable by design, meaning that any improvements are done to the
base image will completely replace the currently running container by
simply destroying the old container and spinning the new one from the
updated base image.

One of the biggest selling points of containerization technology is the
startup/shutdown time, while a virtual machine can take from 30-60
seconds or even more in some special cases to boot and be completely
usable, containers take a fraction of this time at 1-2 seconds.

Even though the two terms Containerization \& Virtualization may appear
as the same thing at first, The reality is that Containerization is not
Virtualization in the common sense, they are fundamentally different in
a lot of aspects. However it can be called OS-level virtualization since
it does not virtualize the hardware for it's ``guests'' but uses the
host's operating system as base to run.

While a virtual machine is created to last as long as it possibly can a
container is the complete opposite of that, a container is started to
only accomplish a single task, once that's done it gets destroyed
instantly this model is called \textbf{Microservices}

using copy-on-wirte cow on aufs filesystem

application containers

operaing system containers

\hypertarget{background-2}{%
\subsubsection{Background}\label{background-2}}

It all started with the \emph{Solaris} \textbf{Zones} formerly known as
\textbf{Solaris Container} \& the \emph{FreeBSD}
\textbf{Jails}\footnote{https://www.freebsd.org/doc/handbook/jails.html}
projects in the early 2000s followed by \emph{Linux}
\textbf{OpenVZ}\footnote{https://openvz.org/} in 2005 then
\textbf{LXC/LXD}\footnote{Linux Containers https://linuxcontainers.org/}
shortly afterwards in 2008.

\begin{figure}
\centering
\includegraphics[width=0.25\textwidth,height=\textheight]{figures/Project-atimic-logo.png}
\caption{project~atomic~logo}
\end{figure}

Docker is one of most successful project \& containerization milestones
started in 2013, few monthes later \textbf{CoreOS Rocket} which is also
called \textbf{rkt} launched, followed by \emph{Project Atomic} has more
of a deeper security focus than any of the formerly mentioned products.

\hypertarget{orchistrators}{%
\subsubsection{Orchistrators}\label{orchistrators}}

It's difficult to talk about containers without mentioning
containerization orchistrators, take a look at any high performance
large scale network and chances are you'll find one of these under the
hood, they basically are a management \& automation frameworks that
makes working with containers easier even at an enterprise scale
infrastructures.

Orchistrators provide many useful features that simply can not be over
looked particularly in enterprise environments where every task is a
challenge, such as self healing and load balancing

\begin{itemize}
\item
  self healing
\item
  load balancing
\item
  \textbf{Kubernetes :}
\end{itemize}

\begin{figure}
\hypertarget{fig:kublogo}{%
\centering
\includegraphics[width=0.4\textwidth,height=\textheight]{figures/kubernetes-text-logo.png}
\caption{Kubernetes~logo}\label{fig:kublogo}
}
\end{figure}

Is an open-source container orchistrator project originally started by
google in order to simplify deployment, management \& scaling of
containeraized environments at google's datacenters.

\begin{itemize}
\tightlist
\item
  \textbf{Mesos :}
\end{itemize}

\begin{figure}
\hypertarget{fig:meslogo}{%
\centering
\includegraphics[width=0.4\textwidth,height=\textheight]{figures/Apache-mesos-text-logo.png}
\caption{Mesos~logo}\label{fig:meslogo}
}
\end{figure}

Initiated and developed by twitter and is now being maintained by
apache, is yet another open-source project that aims at abstracting the
hardware completely and presenting it as giant pool of resources to
virtualized / containeraized systems alike.

\begin{itemize}
\tightlist
\item
  \textbf{Docker Swarm :}
\end{itemize}

\begin{figure}
\hypertarget{fig:swarmlogo}{%
\centering
\includegraphics[width=0.35\textwidth,height=\textheight]{figures/docker-swarm.png}
\caption{Swarm~logo}\label{fig:swarmlogo}
}
\end{figure}

As the name suggests swarm is for docker containers, for clustering a
pool of hosts into a virtual single host

\hypertarget{why-container-in-virtual-machine}{%
\subsubsection{Why Container in Virtual Machine
?}\label{why-container-in-virtual-machine}}

To put it simply ``Security'', Containerization technology is not secure
and should be used with absolut caution under all circumstances.In 2017
\textbf{NIST} National Institute of Standards and
Technologies\footnote{https://www.nist.gov} laid out the reasons why
containerization is not suited for sensitive applications and how it can
be used alongside VMs to tighten the security

\begin{quote}
NIST SP 800-190 Page-25 \emph{``Container management includes security
management and monitoring. However, security controls designed for
non-container environments are often not well suited for use with
containers. For example, consider security controls that take IP
addresses into account. This works well for VMs and bare metal servers
with static IP addresses that remain the same for months or years.
Conversely, containers are typically allocated IP addresses by
orchestrators, and because containers are created and destroyed much
more frequently than VMs, these IP addresses change frequently over time
as well. This makes it difficult or impossible to protect containers
using security techniques that rely on static IP addresses, such as
firewall rule sets filtering traffic based on IP address. Additionally,
a container network can include communications between containers on the
same node, across different nodes, and even across clouds''}
\end{quote}

\hypertarget{chapter-3-security}{%
\chapter{CHAPTER 3 : Security}\label{chapter-3-security}}

\hypertarget{introduction-5}{%
\section{Introduction}\label{introduction-5}}

\emph{``Containers Do Not Contain''} a sentence that every security
researcher will tell you when asked about the subject of
containerization security, negating the illusion that the name
\emph{Container} might give. The issue around containerization is that a
lot of people think that it's a super fast virtualization solution with
the same security advantages and isolation. This misinterpretation leads
to the worst incomes in most of the cases. So what exactly is not secure
about containerization ?

In the previous chapters we have discussed that containerization
technology is not as safe as we thought it is at least when used
improperly, however we've only scratched the surface of why that is. In
the following chapter we're going to take a deep dive in the subject and
hopefully see exactly why, and what we can do about it.

\hypertarget{section-1-threats}{%
\section{SECTION 1 : Threats}\label{section-1-threats}}

\hypertarget{kernel-exploits}{%
\subsection{Kernel Exploits}\label{kernel-exploits}}

As we've seen earlier, containers use the same kernel as the host OS
does, this fact is a security nightmare since in case of kernel panic in
any container all other containers including the host machine it self
will be effected.

\hypertarget{denial-of-service-attacks}{%
\subsection{Denial-Of-Service Attacks}\label{denial-of-service-attacks}}

Unlike a virtual machine a container has unrestricted access to all
system resources such as CPU, RAM \& Storage, a malicious or a badly
configured container could conduct a DOS attack on other processes on
the host system causing resource starvation.

\hypertarget{root-in-root-out}{%
\subsection{Root in = Root out}\label{root-in-root-out}}

Running the root user inside a container is exactly the same as running
as root in the host system. This security flaw opens a lot of
possibilities for hackers.

\hypertarget{privilege-escalation}{%
\subsection{Privilege Escalation}\label{privilege-escalation}}

The ability to forcefully switch users by exploiting vulnerabilities in
the target system. paired with \emph{``root in = root out''} this attack
can have unpleasant consequences.

\begin{itemize}
\tightlist
\item
  \textbf{Horizontal Privesc :} The intruder is able to switch users
  with the same privilege levels, this allows for private data access
  such as home directories.
\end{itemize}

\begin{figure}
\hypertarget{fig:hpresc}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/horiz_presc_diagram.png}
\caption{Horizontal~Privesc~Diagram}\label{fig:hpresc}
}
\end{figure}

\begin{itemize}
\tightlist
\item
  \textbf{Vertical Privesc :} The intruder is able to escalate
  privileges to higher levels such as the \emph{root} user in order to
  gain full access and control over the system.
\end{itemize}

\begin{figure}
\hypertarget{fig:vpresc}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/vert_presc_diagram.png}
\caption{Vertical~Privesc~Diagram}\label{fig:vpresc}
}
\end{figure}

\hypertarget{breakouts}{%
\subsection{Breakouts}\label{breakouts}}

As known as sandbox escapes, is the fact that an attacker could get
access and control over a container and exploiting a vulnerability in it
in order to get out in two ways :

\begin{itemize}
\tightlist
\item
  \textbf{Horizontal escalation :} It starts by the attacker gaining
  access to one of the containers on the host and continues by
  compromising other containers and processes with the same privilege
  level.
\end{itemize}

\begin{figure}
\hypertarget{fig:horesc}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/horiz_esc_diagram.png}
\caption{Horizontal~Escalation~Diagram}\label{fig:horesc}
}
\end{figure}

\begin{itemize}
\tightlist
\item
  \textbf{Vertical escalation :} where the attacker is able to breakout
  to the host system by exploiting a vulnerability in already
  compromised container or by horizontally escalating to another
  vulnerable container.
\end{itemize}

\begin{figure}
\hypertarget{fig:vertesc}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/vert_esc_diagram.png}
\caption{Vertical~Escalation~Diagram}\label{fig:vertesc}
}
\end{figure}

This type of attacks gets even worst knowing that if the attacker has
been able to get root access in any of containers and managed to escape
out to the host, he will run at the same privilege level he used to in
the container in this case root access over the host.

\hypertarget{poisoning}{%
\subsection{Poisoning :}\label{poisoning}}

This happens when downloading base images from an unknown / untrusted
source(s), these images may contain malware, spyware and any kind of
malicious payloads that are extremely difficult to detect \& identify
without full analysis of the image. Deploying a poisoned image will put
the entire host system at risk.

\hypertarget{secret-compromise}{%
\subsection{Secret Compromise :}\label{secret-compromise}}

Hard coded plain text passphrases in containers are a major security
flaw, for instance if the container needs access to a database to fetch
or store some data it will most likely require a passphrase to interact
with the database API. A hacker in this case will have an easy time
getting thous secret keys right after compromising the container.

\hypertarget{section-2-guidelines}{%
\section{SECTION 2 : Guidelines}\label{section-2-guidelines}}

A container can be as secure as a VM and in some cases even more if and
only if some security rules \& practices are respected

\hypertarget{namespaces}{%
\subsection{Namespaces :}\label{namespaces}}

Namespaces are one of most important security components in the Linux
kernel starting from the version 3.8 , A Namespace is an isolated
``environment'' where every element has a unique name regardless of
other namespaces. Even though namespaces can not be directly controlled
by the user it's important to understand them since the containerization
is based on namespacing

\begin{itemize}
\item
  \textbf{Process ID :} for example the init system is PID 1 in unix
  likes operating systems, when using a PIDNamespace every container has
  it's own PIDs starting from PID 1 without conflicting with the host or
  any container.
\item
  \textbf{User/Group ID :} UIDs \& GIDs are also namespaced under every
  container to avoid conflicts.
\item
  \textbf{Mount :} Mounts are namespaced as well
\item
  IPC\footnote{Interprocess Communication}
\item
  \textbf{Network :} Network namespacing is used extensively in
  containerization, And its the key component that makes networking
  significantly more flexible and convenient to use Its what makes
  deploying multiple services on the same host system possible,
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create two network namespaces ns0, ns1}
\ExtensionTok{ip}\NormalTok{ netns add [ns0]}
\ExtensionTok{ip}\NormalTok{ netns add [ns1]}

\CommentTok{\# check that they exist}
\ExtensionTok{ip}\NormalTok{ netns list}

\CommentTok{\# creating virtual ethernet pair}
\ExtensionTok{ip}\NormalTok{ link add [veth0] type veth peer [veth1]}

\CommentTok{\# check}
\ExtensionTok{ip}\NormalTok{ link list}

\CommentTok{\# adding each pair to namespace}
\ExtensionTok{ip}\NormalTok{ link set [veth0] netns [ns0]}
\ExtensionTok{ip}\NormalTok{ link set [veth1] netns [ns1]}

\CommentTok{\# now if we do, we don\textquotesingle{}t see the interfaces any more}
\ExtensionTok{ip}\NormalTok{ link list}

\CommentTok{\# instead we do, to run the command inside the namespace}
\ExtensionTok{ip}\NormalTok{ netns exec [ns0] ip link list}
\ExtensionTok{ip}\NormalTok{ netns exec [ns1] ip link list}

\CommentTok{\# ip address configuration}
\ExtensionTok{ip}\NormalTok{ netns exec [ns0] ip addr add [192.168.1.1/24] dev [veth0]}
\ExtensionTok{ip}\NormalTok{ netns exec [ns1] ip addr add [192.168.2.1/24] dev [veth1]}

\CommentTok{\# bring them up}
\ExtensionTok{ip}\NormalTok{ netns exec [ns0] ip link set [veth0] up}\KeywordTok{\textasciigrave{}}
\ExtensionTok{ip}\NormalTok{ netns exec [ns1] ip link set [veth1] up}
\end{Highlighting}
\end{Shaded}

\hypertarget{cgroups}{%
\subsection{Cgroups}\label{cgroups}}

\hypertarget{definition-4}{%
\subsubsection{Definition}\label{definition-4}}

\emph{cgroups} or \emph{control groups} is a Resource Management linux
kernel mechanism, started by Google in 2006 then ended up in the main
stream kernel a year later in 2007.

They allow the system administrator to control, limit \& monitor various
types of resources through kernel pseudo-filesystem known as cgroupfs.
Multiple subsystems so-called \emph{resource controllers} allow for a
fain grained control over resources in a hierarchical manner, such as
the number of CPU shares, memory limit, Block Device I/O, Typed network
packets. All in a per process basis, This dramatically increases the
systems performance and more importantly, security.

So one may ask, what cgroups has to do with containers ? And the answer
is a lot. At this point it's clear that containerization in general is
based around separation \& isolation and cgroups takes this concept even
further by restricting resource access as necessary for each running
container, this has the benefit of preventing resource starvation as
well as kernel panics in case of a buggy container that has for example
a memory leak or DOS attack leading the entire host to go down.

\hypertarget{manually}{%
\subsubsection{Manually}\label{manually}}

To manage cgroups manually we'll take a look at an example of
controlling the \emph{CPU shares} for three different processes, the I/O
scheduler used for SATA is \emph{CFQ}\footnote{Completely Fair Queuing}
\& \emph{deadline} for other storage types which is specifically
designed with cgroups compatibility in mind.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# what scheduler is used for sda drive}
\FunctionTok{cat}\NormalTok{ /sys/block/sda/queue/scheduler}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# creating the main cgroups directory}
\FunctionTok{mkdir}\NormalTok{ {-}p /my\_cgroups}

\CommentTok{\# creating controllers directories}
\FunctionTok{mkdir}\NormalTok{ {-}p /my\_cgroups/}\DataTypeTok{\{memory,cpusets,cpu\}}

\CommentTok{\# mounting cgroup pseudo file sytems}
\FunctionTok{mount}\NormalTok{ {-}t cgroup {-}o memory none /my\_cgroups/memory}
\FunctionTok{mount}\NormalTok{ {-}t cgroup {-}o cpu,cpuacct none /my\_cgroups/cpu}
\FunctionTok{mount}\NormalTok{ {-}t cgroup {-}o cpuset none /my\_cgroups/cpuset}

\CommentTok{\# creating custom cgroup directories}
\FunctionTok{mkdir}\NormalTok{ {-}p /my\_cgroups/cpu/}\DataTypeTok{\{user1,user2,user3\}}

\CommentTok{\# cpu shares priority example}
\BuiltInTok{echo}\NormalTok{ 2048 }\OperatorTok{\textgreater{}}\NormalTok{ user1/cpu.shares}
\BuiltInTok{echo}\NormalTok{ 768 }\OperatorTok{\textgreater{}}\NormalTok{ user2/cpu.shares}
\BuiltInTok{echo}\NormalTok{ 512 }\OperatorTok{\textgreater{}}\NormalTok{ user3/cpu.shares}

\CommentTok{\# adding the process id\textquotesingle{}s to be effected}
\BuiltInTok{echo}\NormalTok{ [pid] }\OperatorTok{\textgreater{}}\NormalTok{ user1/tasks}
\BuiltInTok{echo}\NormalTok{ [pid] }\OperatorTok{\textgreater{}}\NormalTok{ user2/tasks}
\BuiltInTok{echo}\NormalTok{ [pid] }\OperatorTok{\textgreater{}}\NormalTok{ user3/tasks}
\end{Highlighting}
\end{Shaded}

\hypertarget{systemd}{%
\subsubsection{Systemd}\label{systemd}}

\hypertarget{capabilities}{%
\subsection{Capabilities}\label{capabilities}}

As the name suggests, capabilities allow for fine grained control over
privileges by braking them up into multiple modules each of which is
responsible for granting / denying what the software can do with that
particular capability.

To add a said capability to a docker container the flag
\texttt{-\/-cap-add} is used, the full list of capabilities

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ {-}{-}cap{-}add}
\ExtensionTok{docker}\NormalTok{ {-}{-}cap{-}drop}
\end{Highlighting}
\end{Shaded}

\hypertarget{access-control}{%
\subsection{Access Control :}\label{access-control}}

Taking a look at access control systems, one of the most dangerous
things in any operating system out there is the permissions system this
is because any process started by a given user will completely inherit
that user's permissions and will have access to every thing that he's
able to access. This problem is unfortunately fundamental in how
Discretionary Access Controls DAC mechanism work.

To address this issue another access control system must be used, not
necessarily completely eliminating DAC system and replacing it but by
adding another layer on top of it; This layer is called MAC Mandatory
Access Controls.

\hypertarget{selinux}{%
\subsubsection{SELinux :}\label{selinux}}

\begin{figure}
\hypertarget{fig:selogo}{%
\centering
\includegraphics[width=0.25\textwidth,height=\textheight]{figures/Selinux-logo.png}
\caption{SELinux~logo}\label{fig:selogo}
}
\end{figure}

\hypertarget{definition-5}{%
\paragraph{Definition :}\label{definition-5}}

Security Enhanced Linux is a set of Linux kernel patches as
LSM\footnote{Linux Security Modules} or \emph{Linux Security Modules}
and associated tools developed by the NSA\footnote{National Security
  Agency} released the year 2000 and merged in the main stream kernel
tree in 2003.

SELinux is mainly used by USAs Department Of Defence aka DoD, Therefor
the policies makes heavy use of a security model called \emph{Mandatory
Access Controls} or MAC\footnote{Mandatory Access Controls} for short.
The default access control mechanism on any standard linux based
operating system is DAC\footnote{Discretionary Access Controls} which
stands for \emph{Discretionary Access Controls}, SELinux enhances the
former by adding MAC rules which allow for a much higher security
threshold, the advantage is that policies are strictly applied upon the
users.

To further understand MAC rules let's take an example of root SUID
program. Under DAC access rules running this program will spawn a
process with full system access as the root user allowing for privilege
escalation in case of compromise, However if the correct MAC rules are
enforced by SELinux policies the spawned process will be limited to only
what it's supposed to access in the policies no mater whats the
privilege level is.

\hypertarget{background-3}{%
\paragraph{Background :}\label{background-3}}

SELinux is a labeling system to identify Processes as well as Files,
Directories and System Objects. A policy is used to control the access
between labeled processes and objects, the rules are enforced by the
kernel.

These labels are grouped in SELinux Contexts and they consist of four
elements or labels :

\begin{quote}
user:role:type:level
\end{quote}

After the DAC allow access, the MAC will be evaluated based on VAC the
\emph{Access Vector Cache} the permissions / restrictions which are
applied on subject -\textgreater{} action -\textgreater{} object
requests, in case of a cache miss the SELinux security Server is
requested which is a relatively slower operation, the control access
action then is cached under the VAC for performance reasons.

In case the access is denied based on DAC, MAC will never be checked.
Likewise if no allow policy is found the default access control action
is applied; And that is, access denied.

\hypertarget{security-policy-type}{%
\paragraph{Security Policy Type :}\label{security-policy-type}}

Multiple policy types are used in order for SELinux to make the access
decisions by granting or denying access base on the policy rules of the
policy type of choice :

\begin{itemize}
\tightlist
\item
  \textbf{TE Type Enforcement}
\end{itemize}

\begin{quote}
This model links a label to each process called a domain and label
called a type to each object however internally the is no difference
between a process \emph{domain} and a file \emph{type} since to SELinux
they're both a \emph{type}, the SELinux policy rules then define which
domains SELinux will grant access to which objects based on the
associated types.
\end{quote}

\begin{quote}
The type is represented by the 3rd field and is suffixed with \_t as
follows
\end{quote}

\begin{quote}
user\_u:role\_r:\textbf{type\_t}:level
\end{quote}

\begin{itemize}
\tightlist
\item
  \textbf{RBAC Role Based Access Control}
\end{itemize}

\begin{quote}
Each SELinux user is associated with a set of roles each of which
enables the user to access a set of TE domains. For example the user
\emph{user0} which is in the \emph{staff\_u} SELinux user is able to
take the \emph{webadm\_r, dbadm\_r, viradm\_r}, under the
\emph{webadm\_r} the \emph{user0} is able to administer the web server,
when \emph{user0} switches to the \emph{viradm\_r} he will be no longer
web administrator but a virtualization administrator, and the same goes
for database administrator \emph{dbadm\_r}.
\end{quote}

\begin{quote}
The role is represented by the 2nd field and it's suffixed with \_r as
shown
\end{quote}

\begin{quote}
\textbf{user\_u}:\textbf{role\_r}:type\_t:level
\end{quote}

\begin{itemize}
\tightlist
\item
  \textbf{MLS Multi Level Security}
\end{itemize}

\begin{quote}
This technology is based on BLP\footnote{Bell LaPadula} security model,
which takes access control decision based on the subject clearance label
in order to apply the least privilege principle; For example it can be
structured like the four security levels \emph{TopSecret, Secret,
Classified \& Unclassified}, where a subject with the \emph{Secret}
clearance have read access on lower clearance levels only,
\emph{Classified} in this case, and write access on higher levels
clearance \emph{TopSecret} only, This structure is not mandatory since
there can be more or less levels depending on use case, but it's a
common classification.
\end{quote}

\begin{figure}
\hypertarget{fig:lapadula}{%
\centering
\includegraphics{figures/write_up_read_down.png}
\caption{MLS}\label{fig:lapadula}
}
\end{figure}

\begin{quote}
The principle is simply called \emph{Read Down, Write Up} or
alternatively \emph{No Read Up, No Write Down}, as illustrated in the
figure fig.~\ref{fig:lapadula}.
\end{quote}

\begin{quote}
user\_u:role\_r:type\_t:\textbf{level}
\end{quote}

\begin{itemize}
\tightlist
\item
  \textbf{MCS Multi Category Security}
\end{itemize}

\begin{quote}
categories enable the separation between different departments,
organizations etc. For instance if the access is allowed for TopSecret
Security Level in department (A) category but not department (B)
category. In fact this terminology can be directly projected to the
virtualization \& containerization world, since all the guest children
process will have the same TE label say \emph{cont\_t} inheriting the
starting parent process type, hence the ability for them to read and
write each others image flies of type \emph{cont\_img\_t} which allow
VMs or containers to read and write each others data. This scenario will
make the perfect use case of the \textbf{MCS} scheme by assigning every
guest a unique category level along side it's own image file and
restrict any allowed actions to only matching categories.
\end{quote}

\begin{quote}
The \textbf{MCS} filed is appended to the \textbf{MLS} filed as follows
:
\end{quote}

\begin{quote}
user\_u:role\_r:type\_t:\textbf{level:c}
\end{quote}

\hypertarget{operation-modes}{%
\paragraph{Operation Modes :}\label{operation-modes}}

SELinux main configuration file is \texttt{/etc/selinux/config} which
contain the most basic variables :

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This file controls the state of SELinux on the system on boot.}

\CommentTok{\# SELINUX can take one of these three values:}
\CommentTok{\#       enforcing {-} SELinux security policy is enforced.}
\CommentTok{\#       permissive {-} SELinux prints warnings instead of enforcing.}
\CommentTok{\#       disabled {-} No SELinux policy is loaded.}
\VariableTok{SELINUX=}\NormalTok{permissive}

\CommentTok{\# SELINUXTYPE can take one of these four values:}
\CommentTok{\#       targeted {-} Only targeted network daemons are protected.}
\CommentTok{\#       strict   {-} Full SELinux protection.}
\CommentTok{\#       mls      {-} Full SELinux protection with Multi{-}Level Security}
\CommentTok{\#       mcs      {-} Full SELinux protection with Multi{-}Category Security}
\CommentTok{\#                  (mls, but only one sensitivity level)}
\VariableTok{SELINUXTYPE=}\NormalTok{targeted}
\end{Highlighting}
\end{Shaded}

\texttt{SELINUX} variables has three possible values operation modes :

\begin{itemize}
\tightlist
\item
  Enforcing
\end{itemize}

\begin{quote}
In Enforcing mode SELinux policy rules are applied and any unauthorized
access is denied by the kernel, the denials are also cached under the
AVC and logged by auditd, syslogd, journalctl for further analysis.
\end{quote}

\begin{itemize}
\tightlist
\item
  Permissive
\end{itemize}

\begin{quote}
Permissive mode will log any AVC denials exactly as if access was
forbidden, However the action will still succeed since SELinux will
transparently monitor and log any unauthorized actions. This mode
greatly improves troubleshooting tasks for SELinux policy writers and
developers.
\end{quote}

\begin{itemize}
\tightlist
\item
  Disabled
\end{itemize}

\begin{quote}
As it's name implies under the \emph{Disabled} mode SELinux will be
completely turned off, No logging will be available even if unauthorized
actions were to happen. This mode is not recommended since it may cause
issues in SELinux contexts causing various problems the next time
SELinux is switched back on.
\end{quote}

There is also the \texttt{SELINUXTYPE} variable which is responsible for
the SELinux Security policy type :

\begin{itemize}
\tightlist
\item
  Targeted
\end{itemize}

\begin{quote}
The \emph{Targeted} security policy will target only a subset of the
system subjects and objects specifically those with a hight security
risk such as publicly exposed services by isolating them to
\emph{Confined} SELinux contexts, the rest of the system will be treated
as \emph{Unconfined} domains where only DAC rules will be applied. It's
worth noting that if and \emph{Unconfined} subject runs a process under
\emph{Confinement} the policy rules of the process will be enforced on
the subject.
\end{quote}

\begin{itemize}
\tightlist
\item
  Strict
\end{itemize}

\begin{quote}
The \emph{Strict} security policy will enforce SELinux policy rules on
every subject and object on the system.
\end{quote}

\begin{itemize}
\tightlist
\item
  MLS
\end{itemize}

\begin{quote}
\emph{MLS} security policy type will make use of the 4th field of the
SELinux context labels i.e the \emph{level} label, Enabling clearance
levels access control for fine grained control over the system's
subjects actions over the objects.
\end{quote}

\begin{itemize}
\tightlist
\item
  MCS
\end{itemize}

\begin{quote}
\end{quote}

\hypertarget{cli}{%
\paragraph{CLI :}\label{cli}}

To enable create .autorelable in / and reboot after it's done
relableling all the file system setenforce 1

For all SELinux utilities \texttt{-Z} flag \texttt{mv} command preserves
labels unless \texttt{mv\ -Z}

\begin{itemize}
\tightlist
\item
  \textbf{setenforce}
\end{itemize}

This will turn selinux debugging mode on, so that it will only generate
logs whithout actually denying

\begin{itemize}
\tightlist
\item
  \textbf{selinux} 0
\end{itemize}

This will completely disable selinux so any new content will have no
labels, however this is not a good idea since selinux will not work
without labeled objects if enabled back on instead selinux will relabel
the entire file system, unless the unlabeled objects are relabled
manually before switching selinux on.

\begin{itemize}
\tightlist
\item
  \textbf{sestatus}
\end{itemize}

Check the status of SELinux in the host

\begin{itemize}
\tightlist
\item
  \textbf{seinfo}
\end{itemize}

Information

\begin{itemize}
\tightlist
\item
  \textbf{setsebool}
\end{itemize}

Used to set selinux booleans, to list all available booleans

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{semanage}\NormalTok{ boolean {-}{-}list}

\ExtensionTok{setsebool}\NormalTok{ {-}P httpd\_can\_sendmail 1}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{chcon}
\end{itemize}

Apply temporary changes to context, these change does not survive across
reboots or \texttt{restorecon} command execution.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{chcon}\NormalTok{ {-}t type\_t file\_name}
\CommentTok{\# or with \textquotesingle{}{-}R\textquotesingle{} for dirs}
\ExtensionTok{chcon}\NormalTok{ {-}R {-}t type\_t dir\_name}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{semanage}
\end{itemize}

To manage selinux types like, file contexts with \texttt{fcontext} and
\texttt{login,\ user,\ port...} in a persistent manner even after
relableling the filesystem or restoring contexts using
\texttt{restorecon} unless \texttt{-F} is used to force the restore.

First setting the new file context with \texttt{fcontext}, parameter
\texttt{-a} to add a record, \texttt{-t} for type then the type followed
by the absolute path to the file or directory :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{semanage}\NormalTok{ fcontext {-}a {-}t httpd\_sys\_content abs\_path}
\end{Highlighting}
\end{Shaded}

\begin{quote}
NOTE : The absolute path is required to avoid mislabelling after a file
system relabel.
\end{quote}

However the \texttt{semanage} command is not going to apply the changes
to file, instead it will be added to the default locally managed file
contexts under
\texttt{/etc/selinux/{[}SELINUXTYPE{]}/contexts/files/file\_contexts.local},
hence \texttt{restorecon} is called to apply the changes to the disk

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{restorecon}\NormalTok{ {-}v abs\_path}
\CommentTok{\# or with \textquotesingle{}{-}R\textquotesingle{} for dirs}
\ExtensionTok{restorecon}\NormalTok{ {-}v {-}R abs\_path}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{restorecon}
\end{itemize}

Restore contexts based on the selected policy default file contexts file
under \texttt{/etc/selinux/{[}SELINUXTYPE{]}/contexts/files/} applying
the \texttt{semanage} setting on the inodes from the system defaults
access control file

\begin{itemize}
\tightlist
\item
  \textbf{setfiles}
\end{itemize}

The same as \texttt{restorecon} but works for the entire filesystem in
order to \emph{label} or \emph{relabel} the system tree based on the
default file contexts
\texttt{/etc/selinux/{[}SELINUXTYPE{]}/contexts/files/}.

\begin{itemize}
\tightlist
\item
  \textbf{matchpathcon}
\end{itemize}

Check if the file or directory context matches correctly SELinux files
context as defined under \texttt{/etc/selinux/{[}SELINUXTYPE{]}/files/},
if the context does not match a message will be appear showing the
current context and what context it's supposed to be.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{matchpathcon}\NormalTok{ {-}V /home/user/*}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{newrole}
\end{itemize}

Allows the user to change between multiple roles as long as the SELinux
policy grants it

\begin{itemize}
\tightlist
\item
  \textbf{sepolicy}
\end{itemize}

Manage SELinux policies

\hypertarget{tbl:sepolicy_parm}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:sepolicy_parm}sepolicy parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.18\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.50\columnwidth}\raggedright
Description\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.18\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.50\columnwidth}\raggedright
Description\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.18\columnwidth}\raggedright
boolean\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
SELinux booleans description\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
generate\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Generate SELinux policy template\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
communicate\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Domain communication state\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
network\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Query network information\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
transition\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Generate proccess transition report\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
interface\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
List SELinux policy interfaces\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
manpage\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Generate policy manual pages\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
gui\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Policy graphical user interface\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Will print ssh port}
\ExtensionTok{sepolicy}\NormalTok{ network {-}t ssh\_port\_t}
\end{Highlighting}
\end{Shaded}

For troubleshooting there are few selinux commands that can make it much
easier :

\begin{itemize}
\tightlist
\item
  \textbf{autid2allow}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This will show a diagnostics message with the booleans to turn on}
\FunctionTok{grep}\NormalTok{ ftp /var/log/audit/audit.log }\KeywordTok{|} \ExtensionTok{autid2allow}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{setroubleshoot}
\end{itemize}

\hypertarget{apparmor}{%
\subsubsection{AppArmor :}\label{apparmor}}

It's a linux kernel security module LSM based on MAC, started as
SubDomain from an even older Immunix OS. Owned by SUSE at this point.
And it's installed by default in ubuntu since 2007.

To enable you can make sure that the line
\texttt{APPEND\ apparmor=1\ security=apparmor} in the file
/boot/syslinux/syslinux.cfg

\hypertarget{tomoyo}{%
\subsubsection{TOMOYO :}\label{tomoyo}}

\hypertarget{chapter-4-technologies}{%
\chapter{CHAPTER 4 : Technologies}\label{chapter-4-technologies}}

\hypertarget{introduction-6}{%
\section{Introduction :}\label{introduction-6}}

In this chapter we'll be seeing what are the different software
solutions that we're going to be using during the application phase

\hypertarget{section-1}{%
\section{SECTION 1 :}\label{section-1}}

\hypertarget{linux}{%
\subsection{Linux :}\label{linux}}

\begin{figure}
\centering
\includegraphics[width=0.35\textwidth,height=\textheight]{figures/Linux-logo.png}
\caption{Linux~logo}
\end{figure}

Linux is an open source kernel developed by Linus Torvalds, although it
a lot of people think of GNU/Linux when they say Linux.

\begin{figure}
\centering
\includegraphics[width=0.5\textwidth,height=\textheight]{figures/Archlinux-logo.png}
\caption{Archlinux~logo}
\end{figure}

The specific distribution that we're going to use is Archlinux, which is
a rolling release based distro.

\begin{figure}
\centering
\includegraphics[width=0.35\textwidth,height=\textheight]{figures/Fedora_logo.png}
\caption{Fedora~logo}
\end{figure}

Fedora is a RedHat development distribution made specificaly for the
latest software versions.

\hypertarget{section-2-virtualization}{%
\section{SECTION 2 : Virtualization}\label{section-2-virtualization}}

\hypertarget{qemu}{%
\subsection{Qemu :}\label{qemu}}

\begin{figure}
\centering
\includegraphics[width=0.2\textwidth,height=\textheight]{figures/Qemu-logo.png}
\caption{Qemu~logo}
\end{figure}

\hypertarget{definition-6}{%
\subsubsection{Definition :}\label{definition-6}}

QEMU\footnote{Quick EMUlator} short for is a generic and FOSS\footnote{Free
  \& Open Source Software} Project machine emulator and virtualizer.

Qemu is an emulator that is capable of emulating all sorts of hardware
architecturs, in an x86\_64 architecture the KVM kernel module can be
used to significantly accelerate the virtualizaion.

When used as a machine emulator, QEMU can run OSs and programs made for
one machine (e.g.~an ARM ) on a different machine (e.g.~PC x86) so that
for example we can emulate and android device.

By using dynamic translation, it achieves near native performance by
providing a set of hardware and device models to the guest OS, this
means that the emulated OS runs as if it's on real hardware.

QEMU a specific CPU instructions to run as fast as possible, they are
called hardware-assisted virtualization on intel cpus VT-x and AMD-V on
AMD cpus

as a virtualizer, QEMU achieves near native performance by executing the
guest code directly on the host processing unit. QEMU supports
virtualization when executing under the Xen hypervisor or using the KVM
kernel module in Linux. When using KVM, QEMU can virtualize these
architecturs x86, server and embedded PowerPC, 64-bit POWER, S390,
32-bit and 64-bit ARM, and MIPS guests.

\hypertarget{cli-1}{%
\subsubsection{CLI :}\label{cli-1}}

The qemu cli is an endless sea of arguments and parameters all of which
serves a specific purpose, however we'll be taking a look at the most
useful parameters for x86 \& x86\_64 systems virtualization, the
specific command used is,

\texttt{\$\ -qemu-system-x86\_64}

\hypertarget{central-processing-unit}{%
\paragraph*{Central Processing Unit :}\label{central-processing-unit}}
\addcontentsline{toc}{paragraph}{Central Processing Unit :}

Fist of all the cpu model must be selected and that is achieved with the
\emph{-cpu} flag, to list all available model under the x86\_64
architecture run :

\texttt{\$\ qemu-system-x86\_64\ -cpu\ help}

For the same configuration as the host machine one can use
\texttt{-cpu\ host} .

Setting the number of processing units is done using the \texttt{-smp}
flag, or \emph{Symmetric Multiprocessing}. Which emulates multiple
processing units connected to the same main memory. This flag takes
multiple comma separated parameters in the format
\emph{parameter0=value0, parameter1=value0} .

The \texttt{-smp} flag takes the following parameters as arguments :

\hypertarget{tbl:qemu_cpu_param}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:qemu_cpu_param}Qemu CPU Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.41\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.41\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.16\columnwidth}\raggedright
cpus\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
The number of CPU packages\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
dies\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
Dies per CPU package\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
cores\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
Cores per CPU die\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
threads\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
Threads per core\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
sockets\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
Cpu sockets per mother board\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
maxcpus\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
Maximum hotpluggable CPUs\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{figure}
\hypertarget{fig:cpudiagram}{%
\centering
\includegraphics[width=1\textwidth,height=\textheight]{figures/cpu_diagram.png}
\caption{CPU~Diagram}\label{fig:cpudiagram}
}
\end{figure}

As illustrated fig.~\ref{fig:cpudiagram}.

\hypertarget{main-memory}{%
\paragraph*{Main Memory :}\label{main-memory}}
\addcontentsline{toc}{paragraph}{Main Memory :}

To specify the amount of startup Main Memory the flag \texttt{-m} is
used, this flag take 3 comma separated parameters :

\hypertarget{tbl:qemu_mem_param}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:qemu_mem_param}Qemu Ram Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.55\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.55\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.16\columnwidth}\raggedright
size\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
Memory Amount in Megabytes\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
slots\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
Number of additional hotpluggable slots\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
maxmem\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
Maximum amount of hotpluggable memory\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

The \emph{size} parameter can optionally take \emph{K, M, G, T, P, E}
suffixes for \{ \emph{Kilo, Mega, Giga, Tera, Peta, Exa} \}Bytes
respectively.

\hypertarget{machine-type}{%
\paragraph*{Machine Type :}\label{machine-type}}
\addcontentsline{toc}{paragraph}{Machine Type :}

The machine type specifies the motherboard chipset type. The flag is
\emph{-machine} it has 10 parameters, however we're only interested in
one parameter:

The \emph{accel} parameter can take one of the following values :

\hypertarget{tbl:qemu_accel_param}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:qemu_accel_param}Qemu Acceleration
Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.32\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.41\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.32\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.41\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright
accel\strut
\end{minipage} & \begin{minipage}[t]{0.32\columnwidth}\raggedright
Teh accelerator to use\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
kvm, xen, hax, hvf, whpx, tcg\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Note that for full \emph{kvm} acceleration the flag
\texttt{-machine\ accel=kvm} is used in conjunction with
\texttt{-enable-kvm} flag.

\hypertarget{storage}{%
\paragraph*{Storage :}\label{storage}}
\addcontentsline{toc}{paragraph}{Storage :}

First a disk image must be created if it doesn't exist which is done
using \texttt{qemu-img} command :

\texttt{\$\ qemu-img\ create\ -f\ {[}format{]}\ {[}image\_name{]}\ {[}size{]}}

Where \texttt{{[}format{]}} is the desired format for the image file e.g
\emph{qcow2, qcow, qed, vmdk \ldots{}} , \& \texttt{{[}size{]}} is the
disk space to allocate for the image.

\begin{quote}
NOTE that the image size can be Thinprovisioned or Thikprovisioned
depending on the use case. By default \texttt{qemu-img} creates
Thinprovisioned image files unless told to do otherwise by using the
\texttt{preallocation} option .
\end{quote}

Here are two disk image format with the corresponding
\texttt{preallocation} values :

\hypertarget{tbl:qemu_sto_fmt}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:qemu_sto_fmt}Qemu Storage Formats}\tabularnewline
\toprule
\begin{minipage}[b]{0.20\columnwidth}\raggedright
Image Format\strut
\end{minipage} & \begin{minipage}[b]{0.39\columnwidth}\raggedright
Preallocation Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.20\columnwidth}\raggedright
Image Format\strut
\end{minipage} & \begin{minipage}[b]{0.39\columnwidth}\raggedright
Preallocation Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.20\columnwidth}\raggedright
qcow2\strut
\end{minipage} & \begin{minipage}[t]{0.39\columnwidth}\raggedright
full, falloc, metadate, off\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.20\columnwidth}\raggedright
raw\strut
\end{minipage} & \begin{minipage}[t]{0.39\columnwidth}\raggedright
full, falloc, off\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

There are multiple ways to initiate a storage device in qemu, the most
straightforward is the \texttt{-drive} flag which takes the following
parameters :

\hypertarget{tbl:qemu_sto_decl}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:qemu_sto_decl}Qemu Storage
Initialization}\tabularnewline
\toprule
\begin{minipage}[b]{0.13\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.24\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.55\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.13\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.24\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.55\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.13\columnwidth}\raggedright
file\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\raggedright
The disk image file\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
Path to image file\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
if\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\raggedright
Interface type\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
ide, scsi, sd, mtd, floppy, pflash, virtio, none\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
media\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\raggedright
Media Type\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
disk, cdrom\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
format\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\raggedright
Image format\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
qcow2, raw, qed \ldots{} etc\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
snapshot\strut
\end{minipage} & \begin{minipage}[t]{0.24\columnwidth}\raggedright
Toggle snapshots\strut
\end{minipage} & \begin{minipage}[t]{0.55\columnwidth}\raggedright
on, off\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Another simple way to initiate a block device is to use
\texttt{-hda,\ -hdb,\ -hdc,\ -hdd} flags for storage device and
\texttt{-cdrom,\ -fda,\ -fdb} for CDs \& Floppy disks respectively. Note
that this set of flags take a path to a disk image file with no
parameters required.

Snapshots are one of the most important aspects of virtualization
environments :

\texttt{\$\ qemu-img\ create\ -f\ qcow2\ -b\ origin.qcow2\ origin\_snap.qcow2}

\hypertarget{audio}{%
\paragraph*{Audio :}\label{audio}}
\addcontentsline{toc}{paragraph}{Audio :}

Audio setup is done through the \texttt{-soundhw} flag, this flag's
parameters are the sound card models supported. All The supported sound
cards can be listed with the command :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{qemu{-}system{-}x86\_64}\NormalTok{ {-}soundhw help}
\end{Highlighting}
\end{Shaded}

For the Qemu version used these are the supported ones :

\hypertarget{tbl:qemu_audio_param}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:qemu_audio_param}Qemu Audio
Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.37\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.37\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.16\columnwidth}\raggedright
sb16\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
Creative Sound Blaster 16\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
es1370\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
ENSONIQ AudioPCI ES1370\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
ac97\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
Intel 82801AA AC97 Audio\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
adlib\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
Yamaha YM3812 (OPL2)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
gus\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
Gravis Ultrasound GF1\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
cs4231a\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
CS4231A\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
hda\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
Intel HD Audio\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
pcspk\strut
\end{minipage} & \begin{minipage}[t]{0.37\columnwidth}\raggedright
PC speaker\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{quote}
Note that the most advanced way is to use the \texttt{-audiodev} flag,
which is out of the scope for this paper.
\end{quote}

\hypertarget{network}{%
\paragraph*{Network :}\label{network}}
\addcontentsline{toc}{paragraph}{Network :}

By default Qemu uses \emph{user} networking mode which needs no
privileges to run and it starts automatically with each VM, keep in mind
that ICMP protocol does not work under \emph{user} mode networking. The
default address range for this network is \texttt{10.0.2.0/24} i.e
\texttt{255.255.255.0} subnetmask, with the addresses \texttt{10.0.2.2},
\texttt{10.0.2.3}, \texttt{10.0.2.4} for \emph{Gateway}, \emph{DNS} \&
\emph{SMB}(Optional) respectively, The guests are assigned addresses by
the built-in DHCP server and start from \texttt{10.0.2.15} onwards.

\begin{quote}
Note that the default Qemu address range can be changed by using the
\texttt{-netdiv} flag parameters as \texttt{net=} \& \texttt{dhcpstart=}
. And networking can be completely disabled as \texttt{-nic\ none} .
\end{quote}

For any advanced networking configuration a backend \& frontend are
required hence must be created and configured, The networking backend is
responsible for reading / writing packets from the forntend which is the
VM network interface.

Setting up Qemu network backend is done via the \texttt{-netdev} flag,
there are multiple choices depending on the needs :

\hypertarget{tbl:qemu_net_param}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:qemu_net_param}Qemu Network
Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.13\columnwidth}\raggedright
Backend\strut
\end{minipage} & \begin{minipage}[b]{0.38\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.13\columnwidth}\raggedright
Backend\strut
\end{minipage} & \begin{minipage}[b]{0.38\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.13\columnwidth}\raggedright
user\strut
\end{minipage} & \begin{minipage}[t]{0.38\columnwidth}\raggedright
User mode network\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
tap\strut
\end{minipage} & \begin{minipage}[t]{0.38\columnwidth}\raggedright
Tap interface networking\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
bridge\strut
\end{minipage} & \begin{minipage}[t]{0.38\columnwidth}\raggedright
Bridg interface networking\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

To add a macvtap interface to a qemu VM :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{{-}net}\NormalTok{ nic,model=virtio,macaddr=4e:04:d0:76:ce:07}
\ExtensionTok{{-}net}\NormalTok{ tap,fd=3 }\OperatorTok{3\textless{}\textgreater{}}\NormalTok{/dev/tap6}
\end{Highlighting}
\end{Shaded}

With a startup \& shutdown scripts we can start and stop the
\emph{macvtap} interface as the VM starts and stops

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/bin/bash}

\ExtensionTok{ip}\NormalTok{ link add link [interface] name [macvtap0] type macvtap mode bridge}
\ExtensionTok{ip}\NormalTok{ link set [macvtap0] up}
\FunctionTok{chown}\NormalTok{ :kvm /dev/tap0}
\end{Highlighting}
\end{Shaded}

\texttt{-nic} \texttt{-net} \texttt{-netdev}

\hypertarget{graphics-display}{%
\paragraph*{Graphics \& Display :}\label{graphics-display}}
\addcontentsline{toc}{paragraph}{Graphics \& Display :}

Qemu is able to emulate multiple graphic cards backends. To specify one
use the \texttt{-vga} flag :

\hypertarget{tbl:qemu_gpu_param}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:qemu_gpu_param}Qemu GPU Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.44\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Parameter\strut
\end{minipage} & \begin{minipage}[b]{0.44\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.16\columnwidth}\raggedright
virtio\strut
\end{minipage} & \begin{minipage}[t]{0.44\columnwidth}\raggedright
Virtio VGA output\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
std\strut
\end{minipage} & \begin{minipage}[t]{0.44\columnwidth}\raggedright
Standard VGA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
qxl\strut
\end{minipage} & \begin{minipage}[t]{0.44\columnwidth}\raggedright
QXL VGA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
xenfb\strut
\end{minipage} & \begin{minipage}[t]{0.44\columnwidth}\raggedright
Xen paravirtualized Framebuffer\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
cirrus\strut
\end{minipage} & \begin{minipage}[t]{0.44\columnwidth}\raggedright
Cirrus VGA\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
vmware\strut
\end{minipage} & \begin{minipage}[t]{0.44\columnwidth}\raggedright
Vmware SVGA output\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
none\strut
\end{minipage} & \begin{minipage}[t]{0.44\columnwidth}\raggedright
No Graphics\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

For a display output the \texttt{-display} flag is used with the
following possible values :

\hypertarget{tbl:qemu_disp_param}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:qemu_disp_param}Qemu Display
Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.12\columnwidth}\raggedright
Values\strut
\end{minipage} & \begin{minipage}[b]{0.51\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.12\columnwidth}\raggedright
Values\strut
\end{minipage} & \begin{minipage}[b]{0.51\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.12\columnwidth}\raggedright
gtk\strut
\end{minipage} & \begin{minipage}[t]{0.51\columnwidth}\raggedright
Use a gtk window as graphical output\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\raggedright
vnc\strut
\end{minipage} & \begin{minipage}[t]{0.51\columnwidth}\raggedright
Use the vnc protocol\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\raggedright
curses\strut
\end{minipage} & \begin{minipage}[t]{0.51\columnwidth}\raggedright
Output in text curses/ncurses mode\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\raggedright
none\strut
\end{minipage} & \begin{minipage}[t]{0.51\columnwidth}\raggedright
No graphical output\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

This list is not exhaustive, for the full argument list use the command
:

\texttt{\$\ -qemu-system-x86\_64\ -display\ help}

\hypertarget{random-number-generator}{%
\paragraph*{Random Number Generator :}\label{random-number-generator}}
\addcontentsline{toc}{paragraph}{Random Number Generator :}

If a real \emph{RNG} is required for example for cryptographic key
generation inside a particular VM, It's possible to passthrough the
hosts \emph{RNG} using the \texttt{-object} flag :

\texttt{-object\ rng-random,\ id=id,\ filename=/dev/random}

\hypertarget{kvm}{%
\subsection{Kvm :}\label{kvm}}

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth,height=\textheight]{figures/Kvm-pretty-text-logo.png}
\caption{Kvm~logo}
\end{figure}

Technically KVM\footnote{Kernel-based Virtual Machine} or
\emph{Kernel-based Virtual Machine} is an open-source kernel module for
the Linux kernel, it was announced in 2006 and merged with the main
stream Linux kernel in 2007.

KVM provides it's hypervisor host such as QEMU with the ability to use
hardware assisted virtualization by abstracting the underlying
complexity of Intel-VT and AMD-V cpu virtualization extensions as a
character device \texttt{/dev/kvm}, this essentially turns the host to a
Type-1 / Bare-metal hypervisor.

Without the KVM support Qemu will fallback to software only emulation,
hence several orders of magnitude slower virtualization.

\hypertarget{libvirt}{%
\subsection{Libvirt :}\label{libvirt}}

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth,height=\textheight]{figures/Libvirt-text-logo.png}
\caption{Libvirt~logo}
\end{figure}

\hypertarget{definition-7}{%
\subsubsection{Definition :}\label{definition-7}}

It's an open-source virtualization management library that is capable of
handling multiple virtualization backends, in this project it's a
wrapper around the \texttt{qemu-system-x86\_64} cli interface that is
going to provide extra management functionality that Qemu/KVM is
lacking.

Libvirt can be used to manage various backends such as \emph{Qemu/KVM,
LXC, Xen, Hyper-V, Bhyve} \& \emph{VMware ESXi}, while Qemu uses a cli
syntax as configuration interface, libvirt is able to use cli as well as
XML representation files to setup \emph{Domains} which is the libvirt
term for Virtual Machines.

There are two types of domains in libvirt \emph{Transient} \&
\emph{Persistent}, You can think of the former as being a
pseudo-container it only exists when it's running and it gets destroyed
instantly when turned off, The later however exists under any state.

As stated earlier Libvirt utilities can be used to manage the virtual
environment in two manners, through the command line interface directly
or by using XML description files, so we're going to be looking at both
methods.

\hypertarget{cli-2}{%
\subsubsection{CLI :}\label{cli-2}}

Libvirt uses multiple cli tools to setup Domain resources, The main tool
is \texttt{virsh} or virtualization shell it can be used to \emph{start,
pause, shutdown, destroy} domains amongst other functionality.

To proceed using any of libvirt's utilities a connection must be
established with the hypervisor, and Qemu in this case provide two
options :

\begin{quote}
\texttt{qemu:///system} : local connection as root ( high privilege
level )
\end{quote}

\begin{quote}
\texttt{qemu:///session} : local connection as regular user ( low
privilege level )
\end{quote}

\begin{quote}
NOTE : During the rest of this paper a connection to
\texttt{qemu:///system} URI is always assumed to be established, hence
it wont be mentioned for the sake of simplicity.
\end{quote}

\hypertarget{domain-creation}{%
\paragraph{Domain Creation :}\label{domain-creation}}

To make thing much simpler let's look at an example command :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{virt{-}install} \KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}connect}\NormalTok{ qemu:///system }\KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}virt{-}type}\NormalTok{ kvm }\KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}name}\NormalTok{ guest0 }\KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}ram}\NormalTok{ 2048 }\KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}disk}\NormalTok{ path=/path/to/disk/image,size=80G }\KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}vnc} \KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}cdrom}\NormalTok{ /path/to/cdrom }\KeywordTok{\textbackslash{}}
\ExtensionTok{{-}{-}network}\NormalTok{ network=default,mac=aa:bb:cc:dd:ee:ff}
\end{Highlighting}
\end{Shaded}

This command will create a domain named \emph{guest0}

\hypertarget{central-processing-unit-1}{%
\paragraph{Central Processing Unit :}\label{central-processing-unit-1}}

The \texttt{-\/-cpu} parameter of the \texttt{virt-install} tool, and
the \texttt{\textless{}vcpu\textgreater{}\textless{}/vcpu\textgreater{}}
XML tag

\hypertarget{main-memory-1}{%
\paragraph{Main Memory :}\label{main-memory-1}}

The flag \texttt{-\/-ram} is used to specify the amount of RAM needed
for a guest.

\hypertarget{storage-1}{%
\paragraph{Storage :}\label{storage-1}}

Libvirt uses a concept called storage \emph{pool} \& \emph{volume}, a
\emph{pool} is a reserved disk space to store the \emph{volumes} which
are the gusts disk images. The \emph{pool} can also be transient or
persistent, a transient pool will be destroyed as soon as it's not
needed any more, in the other hand a persistent pool will survive until
it's explicitly destroyed. Both types of pool can be initiated by the
\texttt{pool-create*} and the \texttt{pool-define*} commands in the
\texttt{virsh} interpreter.

\begin{itemize}
\tightlist
\item
  \textbf{Pools}
\end{itemize}

In order to create a disk image a storage pool must be available, to
create local pool directory :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{pool{-}define{-}as}\NormalTok{ {-}{-}name [pool\_name] {-}{-}type dir {-}{-}target [/path/to/dir]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Volumes}
\end{itemize}

Volumes can be created in two ways, by using \texttt{vol-create} and the
\texttt{vol-create-as} commands the former require an XML file with a
description of the \texttt{\textless{}disk\textgreater{}} element, the
later reads input from stdin as parameters.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# the explicit way}
\ExtensionTok{vol{-}create{-}as}\NormalTok{ {-}{-}format [format] {-}{-}pool [pool\_name] {-}{-}name [vol\_name] {-}{-}capacity [50G]}

\CommentTok{\# the short version}
\ExtensionTok{vol{-}create{-}as}\NormalTok{ {-}{-}format [format] [pool\_name] [vol\_name] [50G]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Snapshots}
\end{itemize}

All the libvirt snapshot utilities are in the format
\texttt{snapshot-*}, Snapshots can be created as follows :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{snapshot{-}create{-}as}
\end{Highlighting}
\end{Shaded}

\hypertarget{migration}{%
\paragraph{Migration :}\label{migration}}

Is one of the features that libvirt adds to Qemu, libvirt is capable of
doing \emph{Hot}, \emph{Warm} \& \emph{Cold} migration seamlessly.
Though this operation is only possible if the following conditions are
met :

\begin{itemize}
\tightlist
\item
  Domain's storage is shared amongst the hosts such as NFS.
\item
  The destination host CPU is capable of supporting the domain's CPU
  configuration.
\item
  The source and destination hosts run the same hypervisor version.
\item
  Identical Network configuration.
\end{itemize}

Multiple migration variations are supported :

\hypertarget{tbl:lvirt_mig_param}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:lvirt_mig_param}Libvirt Migration
Parameters}\tabularnewline
\toprule
\begin{minipage}[b]{0.24\columnwidth}\raggedright
Migration\strut
\end{minipage} & \begin{minipage}[b]{0.50\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.24\columnwidth}\raggedright
Migration\strut
\end{minipage} & \begin{minipage}[b]{0.50\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.24\columnwidth}\raggedright
Standard\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
The domain is suspended and resumed\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.24\columnwidth}\raggedright
Peer-to-Peer\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Hosts direct communication\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.24\columnwidth}\raggedright
Tunnelled\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Tunnel creation sush as SSH\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.24\columnwidth}\raggedright
Live / Non-live\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Live migration withou interruption\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.24\columnwidth}\raggedright
Direct\strut
\end{minipage} & \begin{minipage}[t]{0.50\columnwidth}\raggedright
Done by completely hypervisor\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{xml}{%
\subsubsection{XML :}\label{xml}}

Obviously using the libvirt cli only isn't a scalable option, and this
is why XML files can be used to deploy and manage the virtualization
environment .

\hypertarget{domain-initialization}{%
\paragraph*{Domain Initialization :}\label{domain-initialization}}
\addcontentsline{toc}{paragraph}{Domain Initialization :}

\begin{itemize}
\tightlist
\item
  The main element for creating a new domain is the
  \texttt{\textless{}domain\textgreater{}} :
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}domain\textgreater{}\textless{}/domain\textgreater{}}
\end{Highlighting}
\end{Shaded}

It takes tow attributes :

\hypertarget{tbl:lvirt_dom_tag}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_dom_tag}Libvirt Domain Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.32\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.33\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.32\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.33\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright
type\strut
\end{minipage} & \begin{minipage}[t]{0.32\columnwidth}\raggedright
The hypervisor\strut
\end{minipage} & \begin{minipage}[t]{0.33\columnwidth}\raggedright
kvm, qemu, xen, lxc \ldots{}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright
id\strut
\end{minipage} & \begin{minipage}[t]{0.32\columnwidth}\raggedright
ID for running domains\strut
\end{minipage} & \begin{minipage}[t]{0.33\columnwidth}\raggedright
\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

And multiple subelements, the most useful ones are :

\hypertarget{tbl:lvirt_dom_subtags}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:lvirt_dom_subtags}Libvirt Domain
Subtags}\tabularnewline
\toprule
\begin{minipage}[b]{0.18\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.56\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.18\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.56\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.18\columnwidth}\raggedright
name\strut
\end{minipage} & \begin{minipage}[t]{0.56\columnwidth}\raggedright
The VM name\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
uuid\strut
\end{minipage} & \begin{minipage}[t]{0.56\columnwidth}\raggedright
Universal Unique Identifier\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
description\strut
\end{minipage} & \begin{minipage}[t]{0.56\columnwidth}\raggedright
VM description\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.18\columnwidth}\raggedright
metadate\strut
\end{minipage} & \begin{minipage}[t]{0.56\columnwidth}\raggedright
Used by other software to store metadate\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{itemize}
\tightlist
\item
  The next element is the \texttt{\textless{}os\textgreater{}} element :
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}os\textgreater{}\textless{}/os\textgreater{}}
\end{Highlighting}
\end{Shaded}

It has one attribute :

\hypertarget{tbl:lvirt_os_tag}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_os_tag}Libvirt OS Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.32\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.32\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright
firmware\strut
\end{minipage} & \begin{minipage}[t]{0.32\columnwidth}\raggedright
The boot firmware type\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
bios, efi\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

And many subelements are supported as well :

\hypertarget{tbl:lvirt_os_subtags}{}
\begin{longtable}[]{@{}llll@{}}
\caption{\label{tbl:lvirt_os_subtags}Libvirt OS Subtags}\tabularnewline
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.23\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.31\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.23\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.31\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.16\columnwidth}\raggedright
boot\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
dev\strut
\end{minipage} & \begin{minipage}[t]{0.23\columnwidth}\raggedright
Boot device\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
hd, cdrom, network, fd\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
bootmenu\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
enable\strut
\end{minipage} & \begin{minipage}[t]{0.23\columnwidth}\raggedright
Toggle boot menu\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
on, off\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
timeout\strut
\end{minipage} & \begin{minipage}[t]{0.23\columnwidth}\raggedright
Boot menu delay\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
time in ms\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
type\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.23\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
hvm, linux(not really)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
arch\strut
\end{minipage} & \begin{minipage}[t]{0.23\columnwidth}\raggedright
Architecture\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
x86\_64\ldots{}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
machine\strut
\end{minipage} & \begin{minipage}[t]{0.23\columnwidth}\raggedright
Machine type\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
pc-q35, pc-i440fx\ldots{}\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{central-processing-unit-2}{%
\paragraph*{Central Processing Unit :}\label{central-processing-unit-2}}
\addcontentsline{toc}{paragraph}{Central Processing Unit :}

The element tag for adding a new CPU model to a domain is :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}cpu\textgreater{}\textless{}/cpu\textgreater{}}
\end{Highlighting}
\end{Shaded}

Attribute supports :

\hypertarget{tbl:lvirt_cpu_tag}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_cpu_tag}Libvirt CPU Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.28\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.49\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.28\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.49\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright
match\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
CPU matching policy\strut
\end{minipage} & \begin{minipage}[t]{0.49\columnwidth}\raggedright
minimum, exact(default), strict\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright
check\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
Verify the match\strut
\end{minipage} & \begin{minipage}[t]{0.49\columnwidth}\raggedright
none, partial, full\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright
mode\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
Mimic host's CPU\strut
\end{minipage} & \begin{minipage}[t]{0.49\columnwidth}\raggedright
custom, host-model, host-passthrough\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Available subelements are :

\hypertarget{tbl:lvirt_cpu_subtags}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_cpu_subtags}Libvirt CPU
Subtags}\tabularnewline
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.27\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.27\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.16\columnwidth}\raggedright
model\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
CPU model\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
vendor\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
CPU vendor\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
feature\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
policy\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
Feature state\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
cache\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
level\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
Select cache level\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
mode\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
Action on cache\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
topology\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
sockets\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
sockets\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
dies\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
dies\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
cores\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
cores\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright
threads\strut
\end{minipage} & \begin{minipage}[t]{0.27\columnwidth}\raggedright
of threads\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}vcpu\textgreater{}\textless{}vcpu/\textgreater{}}
\end{Highlighting}
\end{Shaded}

With the following attributes :

\hypertarget{tbl:lvirt_vcpu_tag}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_vcpu_tag}Libvirt VCPU Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.41\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.19\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.41\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.19\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright
placement\strut
\end{minipage} & \begin{minipage}[t]{0.41\columnwidth}\raggedright
Pin domain processes to vcpus\strut
\end{minipage} & \begin{minipage}[t]{0.19\columnwidth}\raggedright
static, auto\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

There is also the tags bellow for advanced fine tunning configuration
such as NUMA and multiple physical CPUs, however this is an out of the
scope of this paper :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}cpus\textgreater{}}
 \KeywordTok{\textless{}vcpu}\OtherTok{ id=}\StringTok{\textquotesingle{}\textquotesingle{}}\OtherTok{ enabled=}\StringTok{\textquotesingle{}\textquotesingle{}}\OtherTok{ hotpluggable=}\StringTok{\textquotesingle{}\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/vcpus\textgreater{}}
\end{Highlighting}
\end{Shaded}

And for fine grained tunning :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}cputune\textgreater{}}
\KeywordTok{\textless{}/cputune\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{main-memory-2}{%
\paragraph*{Main Memory :}\label{main-memory-2}}
\addcontentsline{toc}{paragraph}{Main Memory :}

To set RAM amount the following elements are used :

This element sets the maximum upper bound memory amount that the domain
can reach including any hotpluggable RAM.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}maxMemory\textgreater{}\textless{}/maxMemory\textgreater{}}
\end{Highlighting}
\end{Shaded}

Another element is :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}memory\textgreater{}\textless{}/memory\textgreater{}}
\end{Highlighting}
\end{Shaded}

Which sets the maximum boot memory this size can be increased until it
reaches the value specified by
\texttt{\textless{}maxMemory\textgreater{}} element.

Both of the element take the following attributes :

\hypertarget{tbl:lvirt_mem_tag}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_mem_tag}Libvirt Memory Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.22\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.52\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.22\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.52\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright
unit\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
RAM value unit\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
b, KB, k(default), MB, M, GB, G, TB, T\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright
slots\strut
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedright
RAM slots\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Additionally the element :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}currentMemory\textgreater{}}
\KeywordTok{\textless{}/currentMemory\textgreater{}}
\end{Highlighting}
\end{Shaded}

Can be added to set the guest's real allocation of RAM, if this value is
less than the \texttt{\textless{}maxMemory\textgreater{}} value,
ballooning will be able to rise it to the max value depending on the
workload.

\hypertarget{storage-2}{%
\paragraph*{Storage :}\label{storage-2}}
\addcontentsline{toc}{paragraph}{Storage :}

\begin{itemize}
\tightlist
\item
  \textbf{Pools}
\end{itemize}

Storage pools can be created by using an XML file with the
\texttt{\textless{}pool\textgreater{}} element :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}pool}\OtherTok{ type=}\StringTok{"dir"}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}name\textgreater{}}\NormalTok{pool\_name}\KeywordTok{\textless{}/name\textgreater{}}
  \KeywordTok{\textless{}target\textgreater{}}
    \KeywordTok{\textless{}path\textgreater{}}\NormalTok{/path/to/dir}\KeywordTok{\textless{}/path\textgreater{}}
  \KeywordTok{\textless{}/target\textgreater{}}
\KeywordTok{\textless{}/pool\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{pool{-}define}\NormalTok{ pool.xml}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Volumes}
\end{itemize}

Volume creation in XML representation :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}volume\textgreater{}}
  \KeywordTok{\textless{}name\textgreater{}}\NormalTok{vol\_name}\KeywordTok{\textless{}/name\textgreater{}}
  \KeywordTok{\textless{}capacity\textgreater{}}\NormalTok{50G}\KeywordTok{\textless{}/capacity\textgreater{}}
  \KeywordTok{\textless{}allocation\textgreater{}}\NormalTok{0}\KeywordTok{\textless{}/allocation\textgreater{}}
  \KeywordTok{\textless{}target\textgreater{}}
    \KeywordTok{\textless{}format}\OtherTok{ type=}\StringTok{"qcow2"}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}/target\textgreater{}}
\KeywordTok{\textless{}/volume\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{vol{-}create}\NormalTok{ vol.xml}
\end{Highlighting}
\end{Shaded}

Add the created Volume to the domain XML representation the element
\texttt{\textless{}disk\textgreater{}} is used under the parent element
\texttt{\textless{}devices\textgreater{}} :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}disk\textgreater{}}
\KeywordTok{\textless{}/disk\textgreater{}}
\end{Highlighting}
\end{Shaded}

This element support the following set of attributes :

\hypertarget{tbl:lvirt_disk_tag}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_disk_tag}Libvirt Disk Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.20\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.53\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.20\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.53\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright
type\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\raggedright
Disk type\strut
\end{minipage} & \begin{minipage}[t]{0.53\columnwidth}\raggedright
file, block, dir, network, volume, nvme\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright
device\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\raggedright
Exposed as\strut
\end{minipage} & \begin{minipage}[t]{0.53\columnwidth}\raggedright
disk, cdrom, floppy, lun\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright
snapshot\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\raggedright
Snapshot type\strut
\end{minipage} & \begin{minipage}[t]{0.53\columnwidth}\raggedright
internal, external, no\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

The \texttt{\textless{}disk\textgreater{}} element supports the
following subelements :

\hypertarget{tbl:lvirt_disk_subtags}{}
\begin{longtable}[]{@{}llll@{}}
\caption{\label{tbl:lvirt_disk_subtags}Libvirt Disk
Subtags}\tabularnewline
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.14\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.31\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.28\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.16\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.14\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.31\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.28\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.16\columnwidth}\raggedright
source\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
file\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Disk path\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
block\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Host blockdev path\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
dir\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Dir path to use as disk\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
target\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
dev\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Device name\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
sda, hda, vdb\ldots{}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
bus\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Dvice bus\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
ide, scsi, virtio\ldots{}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
driver\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
name\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Disk driver name\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
tap, qemu\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
type\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Driver type\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
aio, raw, qcow2 \ldots{}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.16\columnwidth}\raggedright
readonly\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.31\columnwidth}\raggedright
Don't modify\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright
\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

See the example bellow for \texttt{\textless{}disk\textgreater{}}
element usage sample :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}disk}\OtherTok{ type=}\StringTok{\textquotesingle{}file\textquotesingle{}}\OtherTok{ device=}\StringTok{\textquotesingle{}disk\textquotesingle{}}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}driver}\OtherTok{ name=}\StringTok{\textquotesingle{}qemu\textquotesingle{}}\OtherTok{ type=}\StringTok{\textquotesingle{}raw\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}source}\OtherTok{ file=}\StringTok{\textquotesingle{}/path/to/disk/image\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}target}\OtherTok{ dev=}\StringTok{\textquotesingle{}vda\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}virtio\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/disk\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{networking}{%
\paragraph*{Networking :}\label{networking}}
\addcontentsline{toc}{paragraph}{Networking :}

A network interface can be added using the
\texttt{\textless{}interface\textgreater{}\textless{}/interface\textgreater{}}
tags with the \texttt{type=""} attribute which supports multiple values
:

\hypertarget{tbl:lvirt_if_tag}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:lvirt_if_tag}Libvirt Interface Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.13\columnwidth}\raggedright
Value\strut
\end{minipage} & \begin{minipage}[b]{0.52\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.13\columnwidth}\raggedright
Value\strut
\end{minipage} & \begin{minipage}[b]{0.52\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.13\columnwidth}\raggedright
direct\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
For direct connection such as Macvtap\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
network\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Attach to a pre configured network\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
bridge\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Connect to a bridge device\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.13\columnwidth}\raggedright
user\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Qemu user networking mode SLiRP\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{display}{%
\paragraph*{Display :}\label{display}}
\addcontentsline{toc}{paragraph}{Display :}

This is done through the \texttt{\textless{}graphics\textgreater{}}
element which is a child of \texttt{\textless{}devices\textgreater{}}
tag, the former supports the following attributes :

\hypertarget{tbl:lvirt_disp_tag}{}
\begin{longtable}[]{@{}lll@{}}
\caption{\label{tbl:lvirt_disp_tag}Libvirt Graphics Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.14\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.16\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.62\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.14\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.16\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.62\columnwidth}\raggedright
Values\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.14\columnwidth}\raggedright
type\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\raggedright
Output type\strut
\end{minipage} & \begin{minipage}[t]{0.62\columnwidth}\raggedright
sdl, vnc, spice, rdp, desktop, egl-headless, network\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright
port\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\raggedright
Output port\strut
\end{minipage} & \begin{minipage}[t]{0.62\columnwidth}\raggedright
Port number for remote types\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{graphics-card}{%
\paragraph*{Graphics Card :}\label{graphics-card}}
\addcontentsline{toc}{paragraph}{Graphics Card :}

To specify the GPU characteristics the element
\texttt{\textless{}video\textgreater{}} can be used, this element is a
child of the \texttt{\textless{}devices\textgreater{}} element.

This element supports the following subelements :

\hypertarget{tbl:lvirt_gpu_tag}{}
\begin{longtable}[]{@{}llll@{}}
\caption{\label{tbl:lvirt_gpu_tag}Libvirt Video Tag}\tabularnewline
\toprule
\begin{minipage}[b]{0.12\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.10\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.57\columnwidth}\raggedright
Value\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.12\columnwidth}\raggedright
Subelement\strut
\end{minipage} & \begin{minipage}[b]{0.10\columnwidth}\raggedright
Attribute\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright
Function\strut
\end{minipage} & \begin{minipage}[b]{0.57\columnwidth}\raggedright
Value\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.12\columnwidth}\raggedright
model\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright
type\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright
GPU type\strut
\end{minipage} & \begin{minipage}[t]{0.57\columnwidth}\raggedright
vga, cirrus, vmvga, xen, vbox, qxl, virtio, gop, bochs, rambf,
none\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\raggedright
acceleration\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright
accel2d\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright
2D Accel\strut
\end{minipage} & \begin{minipage}[t]{0.57\columnwidth}\raggedright
yes, no\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.12\columnwidth}\raggedright
\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright
accel3d\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright
3D Accel\strut
\end{minipage} & \begin{minipage}[t]{0.57\columnwidth}\raggedright
yes, no\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{full-domain-xml}{%
\paragraph{Full Domain XML :}\label{full-domain-xml}}

This is full XML representation output of the command
\texttt{virsh\ -\/-connect=qemu:///system} then on the virsh prompt :

\texttt{\#\ edit\ archlinux}

\begin{quote}
Note that the environment variable \texttt{\$EDITOR} will define the
editor used to edit XML, in this case \texttt{\$EDITOR=nvim}
\end{quote}

The domain in question is an \emph{Archlinux} guest, let's break it down
to multiple sections and see what each section does :

This section defines a domain with KVM as a hypervisor the domain is
named \emph{archlinux} with a Universal Unique Identifier \emph{uuid}
which is a unique fingerprint for that specific domain, the
\texttt{\textless{}metadata\textgreater{}} tag is used by other
applications to store Metadata :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}domain}\OtherTok{ type=}\StringTok{\textquotesingle{}kvm\textquotesingle{}}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}name\textgreater{}}\NormalTok{archlinux}\KeywordTok{\textless{}/name\textgreater{}}
  \KeywordTok{\textless{}uuid\textgreater{}}\NormalTok{9f719c2b{-}79f0{-}4192{-}89ec{-}2c78844a72ce}\KeywordTok{\textless{}/uuid\textgreater{}}
  \KeywordTok{\textless{}metadata\textgreater{}}
    \KeywordTok{\textless{}libosinfo:libosinfo}\OtherTok{ xmlns:libosinfo=}\StringTok{"http://libosinfo.org/xmlns/libvirt/domain/1.0"}\KeywordTok{\textgreater{}}
      \KeywordTok{\textless{}libosinfo:os}\OtherTok{ id=}\StringTok{"http://archlinux.org/archlinux/rolling"}\KeywordTok{/\textgreater{}}
    \KeywordTok{\textless{}/libosinfo:libosinfo\textgreater{}}
  \KeywordTok{\textless{}/metadata\textgreater{}}
\end{Highlighting}
\end{Shaded}

Setting the RAM amount to 4GB in
\texttt{\textless{}memory\textgreater{}\textless{}/memory\textgreater{}}
\&
\texttt{\textless{}currentMemory\textgreater{}\textless{}/currentMemory\textgreater{}}
tags, and 2 virtual CPU cores in
\texttt{\textless{}vcpu\textgreater{}\textless{}/vcpu\textgreater{}}
tags :

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}memory}\OtherTok{ unit=}\StringTok{\textquotesingle{}KiB\textquotesingle{}}\KeywordTok{\textgreater{}}\NormalTok{4194304}\KeywordTok{\textless{}/memory\textgreater{}}
  \KeywordTok{\textless{}currentMemory}\OtherTok{ unit=}\StringTok{\textquotesingle{}KiB\textquotesingle{}}\KeywordTok{\textgreater{}}\NormalTok{4194304}\KeywordTok{\textless{}/currentMemory\textgreater{}}
  \KeywordTok{\textless{}vcpu}\OtherTok{ placement=}\StringTok{\textquotesingle{}static\textquotesingle{}}\KeywordTok{\textgreater{}}\NormalTok{2}\KeywordTok{\textless{}/vcpu\textgreater{}}
\end{Highlighting}
\end{Shaded}

The \texttt{\textless{}os\textgreater{}\textless{}/os\textgreater{}} tag
specifies the machine architecture as x86\_64 aka AMD64 and the machine
type to \texttt{pc-q35-5.0} which is equivalent to the
\texttt{qemu-system-x86\_64\ -machine} command, it also sets the boot
device as \texttt{hd} or hard drive :

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}os\textgreater{}}
    \KeywordTok{\textless{}type}\OtherTok{ arch=}\StringTok{\textquotesingle{}x86\_64\textquotesingle{}}\OtherTok{ machine=}\StringTok{\textquotesingle{}pc{-}q35{-}5.0\textquotesingle{}}\KeywordTok{\textgreater{}}\NormalTok{hvm}\KeywordTok{\textless{}/type\textgreater{}}
    \KeywordTok{\textless{}boot}\OtherTok{ dev=}\StringTok{\textquotesingle{}hd\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}/os\textgreater{}}
\end{Highlighting}
\end{Shaded}

The
\texttt{\textless{}features\textgreater{}\textless{}/features\textgreater{}}
tag provide the ability to turn CPU features on or off as needed,
\texttt{\textless{}acpi/\textgreater{}} is a self closing tag with adds
power management features to the domain this allow for features such as
\emph{Graceful Shutdown} to work.
\texttt{\textless{}apic/\textgreater{}} enables \emph{Programmable IRQ
management} that is Interrupt Requests, The last tag
\texttt{\textless{}vmport/\textgreater{}} with the \texttt{state} set to
\texttt{off} disables VMware input/output ports for the current domain :

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}features\textgreater{}}
    \KeywordTok{\textless{}acpi/\textgreater{}}
    \KeywordTok{\textless{}apic/\textgreater{}}
    \KeywordTok{\textless{}vmport}\OtherTok{ state=}\StringTok{\textquotesingle{}off\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}/features\textgreater{}}
\end{Highlighting}
\end{Shaded}

The \texttt{\textless{}cpu/\textgreater{}} is a self closing tag which
specifies the CPU model :

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}cpu}\OtherTok{ mode=}\StringTok{\textquotesingle{}host{-}model\textquotesingle{}}\OtherTok{ check=}\StringTok{\textquotesingle{}partial\textquotesingle{}}\KeywordTok{/\textgreater{}}
\end{Highlighting}
\end{Shaded}

The
\texttt{\textless{}clock\textgreater{}\textless{}/clock\textgreater{}}
tag sets the guest system clock to UTC\footnote{Coordinated Universal
  Time}, it selects three timers

\begin{itemize}
\tightlist
\item
  \texttt{rtc}\footnote{Real Time Clock}, set its \texttt{tickpolicy} to
  \texttt{catchup}, in case of a delay increase the clock rate unit
  guest rtc = host rtc.
\item
  \texttt{pit}\footnote{Programmable Interval Timer}, sets the
  \texttt{tickpolicy} to \texttt{delay}, which is going to keep the
  guests clock delayed.
\item
  \texttt{hpet}\footnote{High Precision Event Timer}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}clock}\OtherTok{ offset=}\StringTok{\textquotesingle{}utc\textquotesingle{}}\KeywordTok{\textgreater{}}
    \KeywordTok{\textless{}timer}\OtherTok{ name=}\StringTok{\textquotesingle{}rtc\textquotesingle{}}\OtherTok{ tickpolicy=}\StringTok{\textquotesingle{}catchup\textquotesingle{}}\KeywordTok{/\textgreater{}}
    \KeywordTok{\textless{}timer}\OtherTok{ name=}\StringTok{\textquotesingle{}pit\textquotesingle{}}\OtherTok{ tickpolicy=}\StringTok{\textquotesingle{}delay\textquotesingle{}}\KeywordTok{/\textgreater{}}
    \KeywordTok{\textless{}timer}\OtherTok{ name=}\StringTok{\textquotesingle{}hpet\textquotesingle{}}\OtherTok{ present=}\StringTok{\textquotesingle{}no\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}/clock\textgreater{}}
\end{Highlighting}
\end{Shaded}

Next is the \texttt{\textless{}on\_poweroff\textgreater{}},
\texttt{\textless{}on\_reboot\textgreater{}} \&
\texttt{\textless{}on\_crash\textgreater{}} tags, and they specify the
action to take in case of \emph{poweroff}, \emph{reboot} \& a system
\emph{crash} :

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}on\_poweroff\textgreater{}}\NormalTok{destroy}\KeywordTok{\textless{}/on\_poweroff\textgreater{}}
  \KeywordTok{\textless{}on\_reboot\textgreater{}}\NormalTok{restart}\KeywordTok{\textless{}/on\_reboot\textgreater{}}
  \KeywordTok{\textless{}on\_crash\textgreater{}}\NormalTok{destroy}\KeywordTok{\textless{}/on\_crash\textgreater{}}
\end{Highlighting}
\end{Shaded}

The \texttt{\textless{}pm\textgreater{}\textless{}/pm\textgreater{}} tag
stands for \emph{power management}, turning off both
\texttt{suspend-to-mem} \& \texttt{suspend-to-disk} which will prevent
the domain from \emph{Suspending} and \emph{Hibernating} :

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}pm\textgreater{}}
    \KeywordTok{\textless{}suspend{-}to{-}mem}\OtherTok{ enabled=}\StringTok{\textquotesingle{}no\textquotesingle{}}\KeywordTok{/\textgreater{}}
    \KeywordTok{\textless{}suspend{-}to{-}disk}\OtherTok{ enabled=}\StringTok{\textquotesingle{}no\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}/pm\textgreater{}}
\end{Highlighting}
\end{Shaded}

To the
\texttt{\textless{}devices\textgreater{}\textless{}/devices\textgreater{}}
tag which will be the parent for all domain devices :

\begin{Shaded}
\begin{Highlighting}[]
  \KeywordTok{\textless{}devices\textgreater{}}
\end{Highlighting}
\end{Shaded}

The
\texttt{\textless{}emulator\textgreater{}\textless{}/emulator\textgreater{}}
tag sets the path to the hypervisor, in this case
\texttt{qemu-system-x86\_64}:

\begin{Shaded}
\begin{Highlighting}[]
   \KeywordTok{\textless{}emulator\textgreater{}}\NormalTok{/usr/bin/qemu{-}system{-}x86\_64}\KeywordTok{\textless{}/emulator\textgreater{}}
\end{Highlighting}
\end{Shaded}

Setting the image disk files to be used by the domain :

\begin{Shaded}
\begin{Highlighting}[]
   \KeywordTok{\textless{}disk}\OtherTok{ type=}\StringTok{\textquotesingle{}file\textquotesingle{}}\OtherTok{ device=}\StringTok{\textquotesingle{}disk\textquotesingle{}}\KeywordTok{\textgreater{}}
     \KeywordTok{\textless{}driver}\OtherTok{ name=}\StringTok{\textquotesingle{}qemu\textquotesingle{}}\OtherTok{ type=}\StringTok{\textquotesingle{}qcow2\textquotesingle{}}\KeywordTok{/\textgreater{}}
     \KeywordTok{\textless{}source}\OtherTok{ file=}\StringTok{\textquotesingle{}/home/user/.vms/arch.qcow2\textquotesingle{}}\KeywordTok{/\textgreater{}}
     \KeywordTok{\textless{}target}\OtherTok{ dev=}\StringTok{\textquotesingle{}vda\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}virtio\textquotesingle{}}\KeywordTok{/\textgreater{}}
     \KeywordTok{\textless{}address}\OtherTok{ type=}\StringTok{\textquotesingle{}pci\textquotesingle{}}\OtherTok{ domain=}\StringTok{\textquotesingle{}0x0000\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}0x04\textquotesingle{}}\OtherTok{ slot=}\StringTok{\textquotesingle{}0x00\textquotesingle{}}\OtherTok{ function=}\StringTok{\textquotesingle{}0x0\textquotesingle{}}\KeywordTok{/\textgreater{}}
   \KeywordTok{\textless{}/disk\textgreater{}}
\end{Highlighting}
\end{Shaded}

Network interface configuration, by creating
\texttt{\textless{}interface\textgreater{}\textless{}/interface\textgreater{}}
tag of type \emph{network} then setting the \emph{mac} address, the
network \emph{source} and the card \emph{model} to \emph{virtio} and the
card address on the pci bus :

\begin{Shaded}
\begin{Highlighting}[]
   \KeywordTok{\textless{}interface}\OtherTok{ type=}\StringTok{\textquotesingle{}network\textquotesingle{}}\KeywordTok{\textgreater{}}
     \KeywordTok{\textless{}mac}\OtherTok{ address=}\StringTok{\textquotesingle{}52:54:00:eb:82:d0\textquotesingle{}}\KeywordTok{/\textgreater{}}
     \KeywordTok{\textless{}source}\OtherTok{ network=}\StringTok{\textquotesingle{}default\textquotesingle{}}\KeywordTok{/\textgreater{}}
     \KeywordTok{\textless{}model}\OtherTok{ type=}\StringTok{\textquotesingle{}virtio\textquotesingle{}}\KeywordTok{/\textgreater{}}
     \KeywordTok{\textless{}address}\OtherTok{ type=}\StringTok{\textquotesingle{}pci\textquotesingle{}}\OtherTok{ domain=}\StringTok{\textquotesingle{}0x0000\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}0x08\textquotesingle{}}\OtherTok{ slot=}\StringTok{\textquotesingle{}0x00\textquotesingle{}}\OtherTok{ function=}\StringTok{\textquotesingle{}0x0\textquotesingle{}}\KeywordTok{/\textgreater{}}
   \KeywordTok{\textless{}/interface\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}input}\OtherTok{ type=}\StringTok{\textquotesingle{}mouse\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}ps2\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}input}\OtherTok{ type=}\StringTok{\textquotesingle{}keyboard\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}ps2\textquotesingle{}}\KeywordTok{/\textgreater{}}
\end{Highlighting}
\end{Shaded}

This is for setting the graphical output (Display) to use the
\emph{Spice} protocol with an automatically selected port number, set
the client to listen on the localhost with image compression turned off
:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}graphics}\OtherTok{ type=}\StringTok{\textquotesingle{}spice\textquotesingle{}}\OtherTok{ autoport=}\StringTok{\textquotesingle{}yes\textquotesingle{}}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}listen}\OtherTok{ type=}\StringTok{\textquotesingle{}address\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}image}\OtherTok{ compression=}\StringTok{\textquotesingle{}off\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/graphics\textgreater{}}
\end{Highlighting}
\end{Shaded}

Sound configuration through the
\texttt{\textless{}sound\textgreater{}\textless{}/sound\textgreater{}}
tags, selecting the sound card model as \texttt{ich9} and setting the
card's address on the PCI bus :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}sound}\OtherTok{ model=}\StringTok{\textquotesingle{}ich9\textquotesingle{}}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}address}\OtherTok{ type=}\StringTok{\textquotesingle{}pci\textquotesingle{}}\OtherTok{ domain=}\StringTok{\textquotesingle{}0x0000\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}0x00\textquotesingle{}}\OtherTok{ slot=}\StringTok{\textquotesingle{}0x1b\textquotesingle{}}\OtherTok{ function=}\StringTok{\textquotesingle{}0x0\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/sound\textgreater{}}
\end{Highlighting}
\end{Shaded}

The next segment is for setting the Graphics Card model to \texttt{qxl},
RAM to 64KB (Primary) the VRAM amount to 64KB (Secondary) \& the VGA
framebuffer to 16KB with 1 output and consider this Video Card as the
primary one :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}video\textgreater{}}
  \KeywordTok{\textless{}model}\OtherTok{ type=}\StringTok{\textquotesingle{}qxl\textquotesingle{}}\OtherTok{ ram=}\StringTok{\textquotesingle{}65536\textquotesingle{}}\OtherTok{ vram=}\StringTok{\textquotesingle{}65536\textquotesingle{}}\OtherTok{ vgamem=}\StringTok{\textquotesingle{}16384\textquotesingle{}}\OtherTok{ heads=}\StringTok{\textquotesingle{}1\textquotesingle{}}\OtherTok{ primary=}\StringTok{\textquotesingle{}yes\textquotesingle{}}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}address}\OtherTok{ type=}\StringTok{\textquotesingle{}pci\textquotesingle{}}\OtherTok{ domain=}\StringTok{\textquotesingle{}0x0000\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}0x00\textquotesingle{}}\OtherTok{ slot=}\StringTok{\textquotesingle{}0x01\textquotesingle{}}\OtherTok{ function=}\StringTok{\textquotesingle{}0x0\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/video\textgreater{}}
\end{Highlighting}
\end{Shaded}

This parts is for Memory Balloon configuration, which enables the host
increase / decrease the guests memory as needed :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}memballoon}\OtherTok{ model=}\StringTok{\textquotesingle{}virtio\textquotesingle{}}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}address}\OtherTok{ type=}\StringTok{\textquotesingle{}pci\textquotesingle{}}\OtherTok{ domain=}\StringTok{\textquotesingle{}0x0000\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}0x05\textquotesingle{}}\OtherTok{ slot=}\StringTok{\textquotesingle{}0x00\textquotesingle{}}\OtherTok{ function=}\StringTok{\textquotesingle{}0x0\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/memballoon\textgreater{}}
\end{Highlighting}
\end{Shaded}

Passingthrough the host's Random Number Generator to the domain :

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}rng}\OtherTok{ model=}\StringTok{\textquotesingle{}virtio\textquotesingle{}}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}backend}\OtherTok{ model=}\StringTok{\textquotesingle{}random\textquotesingle{}}\KeywordTok{\textgreater{}}\NormalTok{/dev/urandom}\KeywordTok{\textless{}/backend\textgreater{}}
  \KeywordTok{\textless{}address}\OtherTok{ type=}\StringTok{\textquotesingle{}pci\textquotesingle{}}\OtherTok{ domain=}\StringTok{\textquotesingle{}0x0000\textquotesingle{}}\OtherTok{ bus=}\StringTok{\textquotesingle{}0x06\textquotesingle{}}\OtherTok{ slot=}\StringTok{\textquotesingle{}0x00\textquotesingle{}}\OtherTok{ function=}\StringTok{\textquotesingle{}0x0\textquotesingle{}}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/rng\textgreater{}}
\end{Highlighting}
\end{Shaded}

Finally the closing tags for \texttt{\textless{}devices\textgreater{}}
and \texttt{\textless{}domain\textgreater{}} :

\begin{Shaded}
\begin{Highlighting}[]
  \ErrorTok{\textless{}}\NormalTok{/devices\textgreater{}}
\ErrorTok{\textless{}}\NormalTok{/domain\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{libguestfs}{%
\subsection{Libguestfs :}\label{libguestfs}}

\begin{figure}
\centering
\includegraphics[width=0.25\textwidth,height=\textheight]{figures/Libguestfs-logo.png}
\caption{Libguestfs~logo}
\end{figure}

As its name implies it is a library that is focused on gust virtual
machine file system modification, i.e performing any possible operations
on guests disk images with a set of command line tools, libguestfs is an
open source project that is developed and maintained by \textbf{RedHat}
and the open source \textbf{community} \& it's written in the \textbf{C}
programming language.

A set of the most important operations that can be done is follows:

\begin{itemize}
\tightlist
\item
  Creating disk images from scratch
\item
  Editing disk images
\item
  Resizing
\item
  Cloning
\item
  Backups
\item
  Building
\item
  Formating
\end{itemize}

LIBGUESTFS is able to access pretty much any existing disk image format
ever known, including proprietary formats such as VM-ware's
\textbf{vmdk} and Hyper-V formats, the main goal behind LIBGUESTFS is to
make a scriptable interface to intereact with various disk image
formats, the following list is the full CLI command list for LIBGUESTFS
:

\begin{itemize}
\tightlist
\item
  \textbf{Using \texttt{guestfish} :}
\end{itemize}

The \texttt{guestfish} command is interactive shell that can be used
directly to manage disk images or by passing command line parameters to
perform the required actions.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# the image format can be added}
\ExtensionTok{guestfish}\NormalTok{ {-}{-}format=qcow2 {-}{-}add /path/to/image.qcow2}
\CommentTok{\# short version}
\ExtensionTok{guestfish}\NormalTok{ {-}{-}format=qcow2 {-}a /path/to/image.qcow2}

\CommentTok{\# if the format isn\textquotesingle{}t specified}
\CommentTok{\# libguestfs will auto detect it}
\ExtensionTok{guestfish}\NormalTok{ {-}a /path/to/image.qcow2}

\CommentTok{\# mounting read only, read write}
\ExtensionTok{guestfish}\NormalTok{ {-}{-}ro {-}{-}mount /dev/sdaX:/ {-}a /path/to/image.qcow2}
\ExtensionTok{guestfish}\NormalTok{ {-}{-}rw {-}{-}mount /dev/sdaX:/ {-}a /path/to/image.qcow2}
\CommentTok{\# short versions}
\ExtensionTok{guestfish}\NormalTok{ {-}{-}ro {-}m /dev/sdaX:/ {-}a /path/to/image.qcow2}
\ExtensionTok{guestfish}\NormalTok{ {-}{-}rw {-}m /dev/sdaX:/ {-}a /path/to/image.qcow2}

\CommentTok{\# connect to a libvirt domain}
\ExtensionTok{guestfish}\NormalTok{ {-}{-}connect qemu:///system {-}{-}domain dom\_name}
\CommentTok{\# the short version}
\ExtensionTok{guestfish}\NormalTok{ {-}c qemu:///system {-}d dom\_name}

\CommentTok{\# copy files in and out}
\ExtensionTok{virt{-}copy{-}out}\NormalTok{ {-}a \textasciitilde{}/.vms/image.qcow2 /path/to/guest/file /path/to/host/dir}
\ExtensionTok{virt{-}copy{-}in}\NormalTok{ {-}a \textasciitilde{}/.vms/arch.qcow2 /path/to/host/file /path/to/guest/dir}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Scripting :}
\end{itemize}

Pure libguestfs script to copy files in and out of disk image directly :

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/usr/bin/guestfish {-}f}

\CommentTok{\# this script will copy a file form the host}
\CommentTok{\# to the guest, and another file the other way}
\CommentTok{\# around.}

\ExtensionTok{add{-}drive}\NormalTok{ /home/user/.vms/image.qcow2}
\ExtensionTok{run}
\FunctionTok{mount}\NormalTok{ /dev/sda1 /}
\ExtensionTok{copy{-}in}\NormalTok{ /path/to/host/file /path/to/target/dir}
\ExtensionTok{copy{-}out}\NormalTok{ /path/to/guest/file /path/to/host/target/dir}
\FunctionTok{umount}\NormalTok{ /dev/sda1}
\ExtensionTok{shutdown}
\BuiltInTok{exit}
\end{Highlighting}
\end{Shaded}

It can be used from within shell scripts either :

\begin{Shaded}
\begin{Highlighting}[]

\CommentTok{\#!/bin/bash}

\ExtensionTok{guestfish} \OperatorTok{\textless{}\textless{} \_EOF\_}
\NormalTok{add{-}drive /home/user/.vms/image.qcow2}
\NormalTok{run}
\NormalTok{mount /dev/sda1 /}
\NormalTok{copy{-}in /path/to/host/file /path/to/target/dir}
\NormalTok{copy{-}out /path/to/guest/file /path/to/host/target/dir}
\NormalTok{umount /dev/sda1}
\NormalTok{shutdown}
\NormalTok{exit}
\OperatorTok{\_EOF\_}
\end{Highlighting}
\end{Shaded}

The complete list of \emph{libguestfs} utilities is represented at the
table tbl.~\ref{tbl:lgfs_tools}, along side a Function column describing
the purpose of each one.

\hypertarget{tbl:lgfs_tools}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:lgfs_tools}Libguestfs Utilities}\tabularnewline
\toprule
\begin{minipage}[b]{0.33\columnwidth}\raggedright
Utility\strut
\end{minipage} & \begin{minipage}[b]{0.61\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.33\columnwidth}\raggedright
Utility\strut
\end{minipage} & \begin{minipage}[b]{0.61\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.33\columnwidth}\raggedright
guestfs\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
main API documentation\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
guestfish\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
interactive shell\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
guestmount\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
mount guest filesystem in host\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
guestunmount\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
unmount guest filesystem\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-alignment-scan\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
check alignment of virtual machine partitions\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-builder\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
quick image builder\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-builder-repository\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
create virt-builder repositories\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-cat\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
display a file\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-copy-in\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
copy files and directories into a VM\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-copy-out\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
copy files and directories out of a VM\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-customize\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
customize virtual machines\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-df\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
free space\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-dib\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
safe diskimage-builder\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-diff\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
differences\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-edit\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
edit a file\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-filesystems\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
display information about filesystems, devices, LVM\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-format\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
erase and make blank disks\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-get-kernel\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
get kernel from disk\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-inspector\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
inspect VM images\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-list-filesystems\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
list filesystems\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-list-partitions\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
list partitions\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-log\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
display log files\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-ls\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
list files\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-make-fs\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
make a filesystem\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-p2v\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
convert physical machine to run on KVM\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-p2v-make-disk\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
make P2V ISO\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-p2v-make-kickstart\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
make P2V kickstart\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-rescue\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
rescue shell\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-resize\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
resize virtual machines\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-sparsify\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
make virtual machines sparse (thin-provisioned)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-sysprep\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
unconfigure a virtual machine before cloning\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-tail\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
follow log file\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-tar\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
archive and upload files\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-tar-in\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
archive and upload files\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-tar-out\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
archive and download files\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-v2v\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
convert guest to run on KVM\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
virt-win-reg\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
export and merge Windows Registry keys\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
libguestfs-test-tool\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
test libguestfs\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
libguestfs-make-fixed-appliance\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
make libguestfs fixed appliance\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
hivex\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
extract Windows Registry hive\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
hivexregedit\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
merge and export Registry changes from regedit-format files\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
hivexsh\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
Windows Registry hive shell\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
hivexml\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
convert Windows Registry hive to XML\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
hivexget\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
extract data from Windows Registry hive\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
febootstrap\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
tool for building supermin appliances\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
febootstrap-supermin-helper\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
febootstrap helper\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
supermin\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
tool for building supermin appliances\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
supermin-helper\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
supermin helper\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.33\columnwidth}\raggedright
guestfsd\strut
\end{minipage} & \begin{minipage}[t]{0.61\columnwidth}\raggedright
guestfs daemon\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{section-3-containerization}{%
\section{SECTION 3 :
Containerization}\label{section-3-containerization}}

\hypertarget{docker}{%
\subsection{Docker :}\label{docker}}

\hypertarget{definition-8}{%
\subsubsection{Definition :}\label{definition-8}}

Docker is the one of the most popular containerization frameworks

\begin{figure}
\centering
\includegraphics[width=0.35\textwidth,height=\textheight]{figures/Docker-logo.png}
\caption{Docker~logo}
\end{figure}

\hypertarget{cli-3}{%
\subsubsection{CLI :}\label{cli-3}}

The main command is \texttt{docker} followed by an action.

\hypertarget{management}{%
\paragraph*{Management :}\label{management}}
\addcontentsline{toc}{paragraph}{Management :}

To download an image from \emph{hub.docker.com} or any other public
repository use :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ pull [mage]}
\end{Highlighting}
\end{Shaded}

To run an image :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ run [image]}
\end{Highlighting}
\end{Shaded}

Assign a name to a container :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ run {-}{-}name [name] [container]}
\end{Highlighting}
\end{Shaded}

To list running container :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ ps}
\ExtensionTok{docker}\NormalTok{ ps {-}a}
\end{Highlighting}
\end{Shaded}

To get an interactive shell inside a container :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ {-}it [container }\KeywordTok{|} \ExtensionTok{id}\NormalTok{] [shell]}
\end{Highlighting}
\end{Shaded}

To stop a running container :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ container sotp [container }\KeywordTok{|} \ExtensionTok{id}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

To remove a running container :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ container rm [container }\KeywordTok{|} \ExtensionTok{id}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\hypertarget{networking-1}{%
\paragraph*{Networking :}\label{networking-1}}
\addcontentsline{toc}{paragraph}{Networking :}

The main command used for managing and configuring docker networks is :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ network COMMAND}
\end{Highlighting}
\end{Shaded}

\hypertarget{tbl:docker_network}{}
\begin{longtable}[]{@{}ll@{}}
\caption{\label{tbl:docker_network}Docker Network}\tabularnewline
\toprule
\begin{minipage}[b]{0.17\columnwidth}\raggedright
Subcommand\strut
\end{minipage} & \begin{minipage}[b]{0.52\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.17\columnwidth}\raggedright
Subcommand\strut
\end{minipage} & \begin{minipage}[b]{0.52\columnwidth}\raggedright
Function\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.17\columnwidth}\raggedright
ls\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
List available networks\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
inspect\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Show networks details\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
connect\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Connect a container to a network\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
disconnect\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Disconnect a container from a network\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
create\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Create a network\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
rm\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Remove a network\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.17\columnwidth}\raggedright
prune\strut
\end{minipage} & \begin{minipage}[t]{0.52\columnwidth}\raggedright
Remove all nuused networks\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\hypertarget{reference-table}{%
\paragraph*{Reference Table :}\label{reference-table}}
\addcontentsline{toc}{paragraph}{Reference Table :}

\hypertarget{dockerfile}{%
\subsubsection{Dockerfile :}\label{dockerfile}}

Dockerfiles are plain text files containing a list of commands just like
shell scripts only with different syntax, these files automate docker
image creation by breaking it into steps starting from an base image,
the docker daemon runs the commands one after the other committing
successful changes to the new image.

To fully understand how dockerfiles internally work let's breakdown it's
syntax rules :

\begin{itemize}
\tightlist
\item
  FROM : for selecting the base image to start building with
\item
  MAINTAINER : Image maintainer name
\item
  WORKDIR : Set current working directory
\item
  ENTRYPOINT : This is the default command to run every time the
  container is started
\item
  ENV : Setting the environment variables for the container
\item
  LABEL : Adding metadate \& description to the image
\item
  ARG :
\item
  USER : Set the user name and the group the initiated container from
  the image is going to run as
\item
  VOLUME : Create a mount point on the container
\item
  COPY : Copy files from host filesystem to container filesystem
\item
  RUN : Run a command inside the container
\item
  ADD : Add files from a remote url to the container
\item
  EXPOSE : Expose a container port so that it can be mapped when the
  container is started, the EXPOSE command is used only to make it clear
  which ports the container uses for other developers
\item
  CMD : Command to run when the container if finally started after the
  building process
\item
  Comments : Comments start with a hash tag \texttt{\#}
\item
  .dockerignore : This file causes the build command to ignore the
  directory it's located in
\end{itemize}

\begin{quote}
Note that the docker file must be named \texttt{Dockerfile} for
\texttt{docker} command to be able to find it.
\end{quote}

In the same directory as the \texttt{Dockerfile} or passing the flag
\texttt{-t} with the \texttt{Dockerfile} \textbf{directory}, running the
command :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ build .}
\CommentTok{\# or}
\ExtensionTok{docker}\NormalTok{ build {-}f /path/to/dir}
\end{Highlighting}
\end{Shaded}

To save the new built image with a given name :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ build {-}t repo/app}
\end{Highlighting}
\end{Shaded}

After the building process is completed check if the image exists :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker}\NormalTok{ images}
\end{Highlighting}
\end{Shaded}

\hypertarget{docker-compose}{%
\subsubsection{Docker compose :}\label{docker-compose}}

Compose plays an important massive in container deployment, it allows
for mass configuration of containers and starting them in a single
command which is not possible or at least a difficult task using plain
docker CLI tools.

It uses the \texttt{YML} or \texttt{YAML} date serialization language
format with \texttt{.yml} or \texttt{.yaml} extension, Bellow is simple
docker compose file structure example :

To start all the containers defined in a given compose configuration
file simply run :

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{docker{-}compose}\NormalTok{ up}
\end{Highlighting}
\end{Shaded}

\hypertarget{lxc}{%
\subsection{LXC :}\label{lxc}}

\begin{figure}
\centering
\includegraphics[width=0.5\textwidth,height=\textheight]{figures/Lxc-logo.png}
\caption{LXC~logo}
\end{figure}

\hypertarget{definition-9}{%
\subsubsection{Definition :}\label{definition-9}}

\hypertarget{section-4-networking}{%
\section{SECTION 4 : Networking}\label{section-4-networking}}

\hypertarget{openvswitch}{%
\subsection{Openvswitch :}\label{openvswitch}}

\begin{figure}
\centering
\includegraphics[width=0.2\textwidth,height=\textheight]{figures/Openvswitch-logo.png}
\caption{OVS~logo}
\end{figure}

\hypertarget{definition-10}{%
\subsubsection{Definition :}\label{definition-10}}

The Openvswitch project is open source Apache 2.0 license, multilayer
production quality virtual switching framework. Designed with
Virtualization in mind and supports all features available in hardware
switches allowing for highly flexible networks.

Here are some of the features supported by Openvswitch, Please keep in
mind that this list is not exhaustive

\begin{itemize}
\tightlist
\item
  Interface Bonding
\item
  LACP - Link Aggregation Control Protocol
\item
  OpenFlow
\item
  Qos - Quality Of Service
\item
  802.1Q VLAN support with trunk \& access ports
\item
  802.1ag for Connectivity Fault Management
\item
  802.1D STP - Spanning Tree Protocol
\end{itemize}

\hypertarget{cli-4}{%
\subsubsection{CLI}\label{cli-4}}

The Openvswitch project is composed of three main components being the
\emph{Database, server \& controller}. The \emph{Database} holds network
configuration \& parameters, The \emph{server} is responsible for
network management and it interfaces with the kernel, Lastly the
\emph{controller} acts as the firmware for the switches

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{systemctl}\NormalTok{ start ovs{-}vswitchd.services}
\ExtensionTok{systemctl}\NormalTok{ enable ovs{-}vswitchd.services}
\end{Highlighting}
\end{Shaded}

The main tool for Openvswitch configuration is

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{ovs{-}vsctl}
\end{Highlighting}
\end{Shaded}

And the here are some of the most useful parameters with a description
of each one

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create bridge}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ add{-}br [bridge\_name]}

\CommentTok{\# remove bridge}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ del{-}br [bridge\_name]}

\CommentTok{\# add port to bridge}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ add{-}port [bridge\_name] [port\_name]}
\CommentTok{\# add port to physical hardware}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ add{-}port [bridge\_name] [interface\_name]}

\CommentTok{\# delete port from bridge}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ add{-}port [bridge\_name] [port\_name]}

\CommentTok{\# list bridges and ports}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ show}

\CommentTok{\# assign a controller to a bridge}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ set{-}controller [bridge\_name] [controller]}

\CommentTok{\# enable spanning tree protocol}
\CommentTok{\# requires infrastructure hardware support}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ set bridge [bridge\_name] stp\_enable=true}
\end{Highlighting}
\end{Shaded}

\hypertarget{linux-virtual-interfaces}{%
\subsection{Linux Virtual Interfaces}\label{linux-virtual-interfaces}}

\hypertarget{definition-11}{%
\subsubsection{Definition}\label{definition-11}}

In order to provide an extremely flexible network configurations the
Linux kernel has the ability to emulate multiple types of network
interfaces in software.

\begin{itemize}
\tightlist
\item
  \textbf{Tun/Tap}
\end{itemize}

Representing a Layer 3 \& 2 device respectively in other words Routing
\& Bridging

\begin{itemize}
\tightlist
\item
  \textbf{Macvtap/Macvlan}
\end{itemize}

It supports multiple modes, \emph{Bridge - VEPA - Passingthrough -
Private }, To initiate a macvtap interface

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{ip}\NormalTok{ link add link [int] name [name] type macvtap mode [mode]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Veth}
\end{itemize}

Veth is a pair of interfaces that acts exactly like an Ethernet cable
with each end like an RJ45 connector,

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{ip}\NormalTok{ link add dev [1st\_pair\_name] type veth peer name [2nd\_pair\_name]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Bridge}
\end{itemize}

Also called a Linux Bridge

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{ip}\NormalTok{ link add [bridge\_name] type bridge}
\end{Highlighting}
\end{Shaded}

\hypertarget{firewalls}{%
\subsection{Firewalls :}\label{firewalls}}

\hypertarget{pfsense}{%
\subsubsection{Pfsense :}\label{pfsense}}

\begin{figure}
\centering
\includegraphics[width=0.55\textwidth,height=\textheight]{figures/Pfsense-blue-text-logo.png}
\caption{Pfsense~logo}
\end{figure}

pfSense software is a free, open source customized distribution of
FreeBSD specifically tailored for use as a firewall and router that is
entirely managed via web interface. In addition to being a powerful,
flexible firewalling and routing platform, it includes a long list of
related features and a package system allowing further expandability
without adding bloat and potential security vulnerabilities to the base
distribution.

The pfSense project is hosted and developed by Rubicon Communications,
LLC (Netgate).

\hypertarget{opnsense}{%
\subsubsection{Opnsense :}\label{opnsense}}

\begin{figure}
\centering
\includegraphics[width=0.55\textwidth,height=\textheight]{figures/Opnsense-logo.png}
\caption{Opnsense~logo}
\end{figure}

OPNsense is an open source, easy-to-use and easy-to-build HardenedBSD
based firewall and routing platform. OPNsense includes most of the
features available in expensive commercial firewalls, and more in many
cases. It brings the rich feature set of commercial offerings with the
benefits of open and verifiable sources.

OPNsense started as a fork of pfSense® and m0n0wall in 2014, with its
first official release in January 2015. The project has evolved very
quickly while still retaining familiar aspects of both m0n0wall and
pfSense. A strong focus on security and code quality drives the
development of the project.

OPNsense offers weekly security updates with small increments to react
on new emerging threats within in a fashionable time. A fixed release
cycle of 2 major releases each year offers businesses the opportunity to
plan upgrades ahead. For each major release a roadmap is put in place to
guide development and set out clear goals.

\hypertarget{chapter-5-application}{%
\chapter{CHAPTER 5 : Application}\label{chapter-5-application}}

\hypertarget{introduction-7}{%
\section{Introduction}\label{introduction-7}}

This Chapter is dedicated to the setup phase on both the
\texttt{Archlinux} virtualization host and the \texttt{Fedora}
containerization guest. The process involves the installation and
configuration of \texttt{Qemu,\ KVM,\ libvirt\ \&\ virt-manager} on the
host side as well as \texttt{selinux,\ docker,\ docker-compose\ \&\ lxc}
on the guest side of things, as shown in the setup diagram
fig.~\ref{fig:netdiagram}

The steps are broken down to three sections two of which are dedicated
for the \emph{Installation \& Configuration} specifically \emph{SECTION
1 \& SECTION 2} in order, And lastly ending with a \emph{Testing} phase
in \emph{SECTION 3} where we'll be deploying some docker containers for
useful services.

\begin{figure}
\hypertarget{fig:netdiagram}{%
\centering
\includegraphics{figures/network_diagram.png}
\caption{Setup~Diagram}\label{fig:netdiagram}
}
\end{figure}

\hypertarget{sec:host}{%
\section{SECTION 1 : Host}\label{sec:host}}

\hypertarget{installation-configuration}{%
\subsection{Installation \&
Configuration}\label{installation-configuration}}

To install all the software needed to set up the \emph{fedora} guest VM
on the \emph{Archlinux} host

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{pacman}\NormalTok{ {-}Syu qemu libvirt virt{-}manager virt{-}viewer openvswitch libguestfs}
\end{Highlighting}
\end{Shaded}

\hypertarget{kvm-1}{%
\subsubsection{KVM}\label{kvm-1}}

Check whether the \texttt{kvm} kernel module is enabled

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lsmod} \KeywordTok{|} \FunctionTok{grep}\NormalTok{ kvm}
\end{Highlighting}
\end{Shaded}

If no output is shown then \texttt{kvm} is disabled, to enable it along
side the \texttt{nested} virtualization feature required for the
Qemu/kvm web interface in the \texttt{Archlinux\ Guest}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# for intel}
\BuiltInTok{echo} \StringTok{"options kvm{-}intel nested=1"} \OperatorTok{\textgreater{}}\NormalTok{ /etc/modprobe.d/kvm{-}intel.conf}

\CommentTok{\# for amd}
\BuiltInTok{echo} \StringTok{"options kvm{-}amd nested=1"} \OperatorTok{\textgreater{}}\NormalTok{ /etc/modprobe.d/kvm{-}amd.conf}
\end{Highlighting}
\end{Shaded}

\hypertarget{libvirt-1}{%
\subsubsection{Libvirt}\label{libvirt-1}}

Enabling \& starting the \texttt{libvirtd.service} service

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# start sevice}
\ExtensionTok{systemctl}\NormalTok{ start libvirtd.service}
\CommentTok{\# enable it}
\ExtensionTok{systemctl}\NormalTok{ enable libvirtd.service}

\CommentTok{\# check whether it\textquotesingle{}s running}
\ExtensionTok{systemctl}\NormalTok{ is{-}active libvirtd.service}
\ExtensionTok{systemctl}\NormalTok{ status libvirtd.service}
\end{Highlighting}
\end{Shaded}

We must create a storage pool first by creating a file \texttt{pool.xml}
with the following content, this process must be only once then all disk
image files will be in the created pool unless another pool is required

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}pool}\OtherTok{ type=}\StringTok{"dir"}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}name\textgreater{}}\NormalTok{.vms}\KeywordTok{\textless{}/name\textgreater{}}
  \KeywordTok{\textless{}target\textgreater{}}
    \KeywordTok{\textless{}path\textgreater{}}\NormalTok{/home/user/.vms}\KeywordTok{\textless{}/path\textgreater{}}
  \KeywordTok{\textless{}/target\textgreater{}}
\KeywordTok{\textless{}/pool\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the virsh interpreter}
\ExtensionTok{pool{-}define}\NormalTok{ {-}{-}file pool.xml}

\CommentTok{\# or without an xml file}
\ExtensionTok{pool{-}define{-}as}\NormalTok{ {-}{-}name .vms {-}{-}type dir {-}{-}target /home/user/.vms}
\CommentTok{\# the short version}
\ExtensionTok{pool{-}define{-}as}\NormalTok{ .vms dir {-}{-}target /home/user/.vms}

\CommentTok{\# then build, start and autostart the pool}
\ExtensionTok{pool{-}start}\NormalTok{ {-}{-} build {-}{-}pool.vms}
\ExtensionTok{pool{-}autostart}\NormalTok{ {-}{-}pool .vms}
\end{Highlighting}
\end{Shaded}

Now we need to make network connectivity available for the guest VMs by
using an Openvswitch bridge as a network. We start by creating the
network definition \texttt{ovsbr-net.xml} file

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}network\textgreater{}}
    \KeywordTok{\textless{}name\textgreater{}}\NormalTok{ovsbr0}\KeywordTok{\textless{}/name\textgreater{}}
    \KeywordTok{\textless{}forward}\OtherTok{ mode=}\StringTok{"bridge"}\KeywordTok{/\textgreater{}}
    \KeywordTok{\textless{}bridge}\OtherTok{ name=}\StringTok{"ovsbr0"}\KeywordTok{/\textgreater{}}
    \KeywordTok{\textless{}virtualport}\OtherTok{ type=}\StringTok{"openvswitch"}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/network\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# define the network}
\ExtensionTok{net{-}define}\NormalTok{ {-}{-}file ovsbr{-}net.xml}

\CommentTok{\# check if the network exists}
\ExtensionTok{net{-}list}\NormalTok{ {-}{-}all}

\CommentTok{\# start it and enable automatic start}
\ExtensionTok{net{-}start}\NormalTok{ {-}{-}network ovsbr{-}net}
\ExtensionTok{net{-}autostart}\NormalTok{ {-}{-}network ovsbr{-}net}
\end{Highlighting}
\end{Shaded}

\hypertarget{openvswitch-1}{%
\subsubsection{Openvswitch}\label{openvswitch-1}}

Enabling \& starting \texttt{ovs-vswitchd.service} service to handle
network configuration

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# starting service}
\ExtensionTok{systemctl}\NormalTok{ start ovs{-}vswitchd.service}
\CommentTok{\# enabling it}
\ExtensionTok{systemctl}\NormalTok{ enable ovs{-}vswitchd.service}

\CommentTok{\# check whether it started successfuly}
\ExtensionTok{systemctl}\NormalTok{ is{-}active ovs{-}vswitchd.service}
\ExtensionTok{systemctl}\NormalTok{ status ovs{-}vswitchd.service}
\end{Highlighting}
\end{Shaded}

Initialization of the database for the first run only, this command has
no effect if the DB is already initialized

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{ovs{-}vsctl}\NormalTok{ init}
\end{Highlighting}
\end{Shaded}

Creating an Openvswitch bridge called \texttt{ovsbr0}, then assigning
the ethernet physical interface \texttt{enp0s20f0u1}to a vswitch port

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{ovs{-}vsctl}\NormalTok{ add{-}br ovsbr0}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ add{-}port ovsbr0 enp0s20f0u1}

\CommentTok{\# check}
\ExtensionTok{ovs{-}vsctl}\NormalTok{ show}
\end{Highlighting}
\end{Shaded}

\hypertarget{fedora-guest}{%
\subsubsection{Fedora Guest}\label{fedora-guest}}

\begin{itemize}
\tightlist
\item
  \textbf{Storage}
\end{itemize}

We'll start by creating a \emph{thinprovisioned} or in other words a
\emph{sparse} \emph{qcow2} format disk image of 100G in the
\texttt{.vms} directory

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# creating the disk image}
\ExtensionTok{qemu{-}img}\NormalTok{ create {-}f qcow2 \textasciitilde{}/.vms/fedora33.qcow2 100G}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Or by using virsh}
\ExtensionTok{vol{-}create{-}as}\NormalTok{ {-}{-}name fedora33.qcow2 {-}{-}format qcow2 {-}{-}pool .vms {-}{-}capacity 100G}
\ExtensionTok{vol{-}list}\NormalTok{ {-}{-}pool .vms}
\end{Highlighting}
\end{Shaded}

Then creating a file \texttt{disk.xml} with the content bellow, and
using \texttt{virsh} command \texttt{vol-create}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\textless{}!{-}{-} alternative way using libvirt xml file {-}{-}\textgreater{}}
\KeywordTok{\textless{}volume\textgreater{}}
  \KeywordTok{\textless{}name\textgreater{}}\NormalTok{vol.qcow2}\KeywordTok{\textless{}/name\textgreater{}}
  \KeywordTok{\textless{}capacity\textgreater{}}\NormalTok{107374182400}\KeywordTok{\textless{}/capacity\textgreater{}}
  \KeywordTok{\textless{}allocation\textgreater{}}\NormalTok{0}\KeywordTok{\textless{}/allocation\textgreater{}}
  \KeywordTok{\textless{}target\textgreater{}}
    \KeywordTok{\textless{}format}\OtherTok{ type=}\StringTok{"qcow2"}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}/target\textgreater{}}
\KeywordTok{\textless{}/volume\textgreater{}}
\end{Highlighting}
\end{Shaded}

Now using \texttt{virsh\ -\/-connect\ qemu:///system}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the virsh interpreter}
\ExtensionTok{connect}\NormalTok{ qemu:///system}
\ExtensionTok{vol{-}create}\NormalTok{ {-}{-}file disk.xml {-}{-}pool .vms}

\CommentTok{\# or without an xml file}
\ExtensionTok{vol{-}create{-}as}\NormalTok{ {-}{-}format qcow2 {-}{-}pool .vms {-}{-}name fedora33.qcow2 {-}{-}capacity 100G}
\CommentTok{\# the short version}
\ExtensionTok{vol{-}create{-}as}\NormalTok{ .vms fedora33.qcow2 100G}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Network}
\end{itemize}

For the Qemu/kvm guests network connectivity, Openvswitch bridge
\texttt{ovsbr0} is used

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}interface}\OtherTok{ type=}\StringTok{"bridge"}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}source}\OtherTok{ bridge=}\StringTok{"ovsbr0"}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}virtualport}\OtherTok{ type=}\StringTok{"openvswitch"}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}target}\OtherTok{ dev=}\StringTok{"fedora\_port"}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/interface\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Starting}
\end{itemize}

To start the \emph{fedora} VM we create a shell script with the
following content and make it executable :

\begin{Shaded}
\begin{Highlighting}[]
 \ExtensionTok{virt{-}install}\NormalTok{ {-}{-}connect qemu:///system }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}name}\NormalTok{ fedora33 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}memory}\NormalTok{ 4096 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}vcpus}\NormalTok{ 1 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}cpu}\NormalTok{ host,secure=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}features}\NormalTok{ kvm.hidden.state=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}cdrom}\NormalTok{ /home/user/Downloads/Fedora{-}Server{-}dvd{-}x86\_64{-}33{-}1.2.iso }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}boot}\NormalTok{ bootmenu.enable=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}os{-}variant}\NormalTok{ archlinux }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}disk}\NormalTok{ /home/user/.vms/fedora33.qcow2 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}network}\NormalTok{ network=ovsbr0 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}os{-}variant}\NormalTok{ detect=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}hvm} \KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}virt{-}type}\NormalTok{=kvm }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}memballoon}\NormalTok{ virtio }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}rng}\NormalTok{ /dev/urandom }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}machine}\NormalTok{ q35 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}events}\NormalTok{ on\_poweroff=destroy,on\_reboot=restart,on\_crash=destroy }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}graphics}\NormalTok{ vnc}
\end{Highlighting}
\end{Shaded}

Which can also be done using \texttt{qemu-system-x86\_64} command, With
\texttt{macvtap} interface instead

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/usr/bin/zsh}

\ExtensionTok{/usr/bin/qemu{-}system{-}x86\_64} \KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}monitor}\NormalTok{ stdio }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}smp}\NormalTok{ 2,cores=2,threads=1,sockets=1 }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}cpu}\NormalTok{ host }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}device}\NormalTok{ intel{-}hda }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}device}\NormalTok{ hda{-}duplex }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}vga}\NormalTok{ virtio }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}machine}\NormalTok{ accel=kvm }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}m}\NormalTok{ 4096 }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}drive}\NormalTok{ file=}\StringTok{"/home/user/.vms/fedora33.qcow2"}\NormalTok{,if=virtio,media=disk }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}drive}\NormalTok{ file=}\StringTok{"/home/user/Downloads/Fedora{-}Server{-}dvd{-}x86\_64{-}33{-}1.2.iso"}\NormalTok{,if=virtio,media=cdrom }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}net}\NormalTok{ nic,model=virtio,macaddr=}\VariableTok{$(}\FunctionTok{cat}\NormalTok{ /sys/class/net/tap\_fed0/address}\VariableTok{)} \KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}net}\NormalTok{ tap,fd=3 }\OperatorTok{3\textless{}\textgreater{}}\NormalTok{/dev/tap6 }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}boot}\NormalTok{ menu=on }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}rtc}\NormalTok{ base=localtime }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}name} \StringTok{"fedora"}
\end{Highlighting}
\end{Shaded}

After starting the Qemu/kvm fedora 33 server edition VM from the
installation iso, the installer will boot automatically to the
Installation main menu as shown at fig.~\ref{fig:fedmenu}

\begin{figure}[!htb]
\hypertarget{fig:fedmenu}{%
\centering
\includegraphics{figures/screenshots/fedora_menu.png}
\caption{Installation~Menu}\label{fig:fedmenu}
}
\end{figure}

The next thing is the users passwords configuration, by clicking on the
\emph{Root Password} menu and filling the form as needed by the system
administrator fig.~\ref{fig:fedrootpass}

\begin{figure}[!htb]
\hypertarget{fig:fedrootpass}{%
\centering
\includegraphics{figures/screenshots/fedora_root_pass.png}
\caption{Root~Password}\label{fig:fedrootpass}
}
\end{figure}

After that we'll create a user and give him administrative privileges by
clicking on the \emph{User Creation}, this step is highly recommended so
that we don't login as root for security reasons
fig.~\ref{fig:feduserpass}

\begin{figure}[!htb]
\hypertarget{fig:feduserpass}{%
\centering
\includegraphics{figures/screenshots/fedora_user_pass.png}
\caption{User~Password}\label{fig:feduserpass}
}
\end{figure}

The final step in the installation is to click on the \emph{Begin
Installation}, and the installer progress will be shown
fig.~\ref{fig:fedprogress}

\begin{figure}[!htb]
\hypertarget{fig:fedprogress}{%
\centering
\includegraphics{figures/screenshots/fedora_progress.png}
\caption{Installation~Progress}\label{fig:fedprogress}
}
\end{figure}

After the installation finishes reboot the server.

\hypertarget{archlinux-guest}{%
\subsubsection{Archlinux Guest}\label{archlinux-guest}}

\begin{itemize}
\tightlist
\item
  \textbf{Storage}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# creating the disk image}
\ExtensionTok{qemu{-}img}\NormalTok{ create {-}f qcow2 \textasciitilde{}/.vms/arch.qcow2 100G}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{vol{-}create{-}as}\NormalTok{ {-}{-}name arch.qcow2 {-}{-}format qcow2 {-}{-}pool .vms\_test {-}{-}capacity 100G}
\ExtensionTok{vol{-}list}\NormalTok{ {-}{-}pool .vms}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Network}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}interface}\OtherTok{ type=}\StringTok{"bridge"}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}source}\OtherTok{ bridge=}\StringTok{"ovsbr0"}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}virtualport}\OtherTok{ type=}\StringTok{"openvswitch"}\KeywordTok{/\textgreater{}}
  \KeywordTok{\textless{}target}\OtherTok{ dev=}\StringTok{"arch\_port"}\KeywordTok{/\textgreater{}}
\KeywordTok{\textless{}/interface\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{Starting}
\end{itemize}

The final step after installing the guest is to start the VM with the
required specifications by using the \texttt{virt-install} command with
the right set of parameters

\begin{Shaded}
\begin{Highlighting}[]
 \ExtensionTok{virt{-}install}\NormalTok{ {-}{-}connect qemu:///system }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}name}\NormalTok{ arch }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}memory}\NormalTok{ 4096 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}vcpus}\NormalTok{ 2 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}cpu}\NormalTok{ host,secure=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}features}\NormalTok{ kvm.hidden.state=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}cdrom}\NormalTok{ /home/user/Downloads/archlinux{-}2020.05.01{-}x86\_64.iso }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}boot}\NormalTok{ bootmenu.enable=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}os{-}variant}\NormalTok{ archlinux }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}disk}\NormalTok{ /home/user/.vms/arch.qcow2 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}network}\NormalTok{ network=ovsbr0 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}os{-}variant}\NormalTok{ detect=on }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}hvm} \KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}virt{-}type}\NormalTok{=kvm }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}memballoon}\NormalTok{ virtio }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}rng}\NormalTok{ /dev/urandom }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}machine}\NormalTok{ q35 }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}events}\NormalTok{ on\_poweroff=destroy,on\_reboot=restart,on\_crash=destroy }\KeywordTok{\textbackslash{}}
  \ExtensionTok{{-}{-}graphics}\NormalTok{ vnc}
\end{Highlighting}
\end{Shaded}

Just as a side note, The VM can also be started by using Qemu directly
with the following command

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/usr/bin/zsh}

\ExtensionTok{/usr/bin/qemu{-}system{-}x86\_64} \KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}monitor}\NormalTok{ stdio }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}smp}\NormalTok{ 2,cores=2,threads=1,sockets=1 }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}cpu}\NormalTok{ host }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}device}\NormalTok{ intel{-}hda }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}device}\NormalTok{ hda{-}duplex }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}vga}\NormalTok{ virtio }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}machine}\NormalTok{ accel=kvm }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}m}\NormalTok{ 4096 }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}drive}\NormalTok{ file=}\StringTok{"/home/user/.vms/arch.qcow2 "}\NormalTok{,if=virtio,media=disk }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}drive}\NormalTok{ file=}\StringTok{"/home/user/Downloads/archlinux{-}2020.05.01{-}x86\_64.iso "}\NormalTok{,if=virtio,media=cdrom }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}net}\NormalTok{ nic,model=virtio,macaddr=}\VariableTok{$(}\FunctionTok{cat}\NormalTok{ /sys/class/net/tap\_arch0/address}\VariableTok{)} \KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}net}\NormalTok{ tap,fd=3 }\OperatorTok{3\textless{}\textgreater{}}\NormalTok{/dev/tap6 }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}boot}\NormalTok{ menu=on }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}rtc}\NormalTok{ base=localtime }\KeywordTok{\textbackslash{}}
    \ExtensionTok{{-}name} \StringTok{"fedora"}
\end{Highlighting}
\end{Shaded}

When the VM boots install \textbf{Archlinux}

\begin{Shaded}
\begin{Highlighting}[]

\ExtensionTok{fdisk}\NormalTok{ /dev/vda}
\ExtensionTok{fdisk}\NormalTok{ {-}l}
\ExtensionTok{mkfs.ext4}\NormalTok{ /dev/}\DataTypeTok{\{vda1,vda2\}}
\FunctionTok{mkdir}\NormalTok{ /mnt/home}
\FunctionTok{mount}\NormalTok{ /dev/vda1 /mnt}
\FunctionTok{mount}\NormalTok{ /dev/vda2 /home}
\ExtensionTok{pacstrap}\NormalTok{ {-}i /mnt base linux linux{-}firmware sudo vim}
\ExtensionTok{genfstab}\NormalTok{ {-}U {-}p /mnt }\OperatorTok{\textgreater{}\textgreater{}}\NormalTok{ /mnt/etc/fstab}

\ExtensionTok{arch{-}chroot}\NormalTok{ /mnt /bin/bash}
\BuiltInTok{echo} \StringTok{"en\_US.UTF{-}8 UTF{-}8"} \OperatorTok{\textgreater{}\textgreater{}}\NormalTok{ /etc/locale.gen}
\ExtensionTok{locale{-}gen}
\BuiltInTok{echo} \StringTok{"LANG=en\_US.UTF{-}8"} \OperatorTok{\textgreater{}}\NormalTok{ /etc/locale.conf}

\FunctionTok{ln}\NormalTok{ {-}sf /usr/share/zoneinfo/Africa/Algiers /etc/localtime}
\ExtensionTok{hwclock}\NormalTok{ {-}{-}systohc {-}{-}utc}

\BuiltInTok{echo} \StringTok{"archserver"} \OperatorTok{\textgreater{}}\NormalTok{ /etc/hostname}
\BuiltInTok{echo} \StringTok{"127.0.0.1 localhost.localdomain archserver"} \OperatorTok{\textgreater{}}\NormalTok{ /etc/hosts}

\ExtensionTok{pacman}\NormalTok{ {-}S NetworkManager}
\ExtensionTok{systemctl}\NormalTok{ enable NetworkManager}

\FunctionTok{passwd}

\ExtensionTok{pacman}\NormalTok{ {-}S grub}
\ExtensionTok{grub{-}install}\NormalTok{ /dev/vda}
\ExtensionTok{grub{-}mkconfig}\NormalTok{ {-}o /boot/grub/grub.cfg}
\BuiltInTok{exit}

\FunctionTok{umount}\NormalTok{ {-}R /mnt}
\ExtensionTok{reboot}
\end{Highlighting}
\end{Shaded}

\hypertarget{sec:guests}{%
\section{SECTION 2 : Guests}\label{sec:guests}}

\hypertarget{fedora-guest-1}{%
\subsection{Fedora Guest}\label{fedora-guest-1}}

\hypertarget{selinux-1}{%
\subsubsection{SElinux}\label{selinux-1}}

Check weather SELinux is running in enforcing mode by running

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{sestatus}

\CommentTok{\# for some operations selinux must be in permissive}
\ExtensionTok{setenforce}\NormalTok{ 0}
\end{Highlighting}
\end{Shaded}

When the server boots back up, login and update the package manager's
cache

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{yum}\NormalTok{ update}
\end{Highlighting}
\end{Shaded}

\hypertarget{containerization-1}{%
\subsubsection{Containerization}\label{containerization-1}}

Next let's install the containerization software

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{yum}\NormalTok{ install docker docker{-}compose lxc}
\end{Highlighting}
\end{Shaded}

\hypertarget{docker-1}{%
\subsubsection{Docker}\label{docker-1}}

Add user to docker group

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{usermod}\NormalTok{ {-}aG docker user}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{systemctl}\NormalTok{ start docker.service}
\ExtensionTok{systemctl}\NormalTok{ enable docker.service}
\end{Highlighting}
\end{Shaded}

Next we'll deploy a handful of docker containers for services that we
need in production

perkeep

nextcloud

git lab community

Discourse

mediawiki

plexinc/pms-docker

teamspeak

mailu/postfix

https://github.com/jitsi/docker-jitsi-meet

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{FROM}\NormalTok{ alpine:3.7}

\KeywordTok{RUN}\NormalTok{ apk add {-}{-}no{-}cache postfix postfix{-}sqlite postfix{-}pcre rsyslog python py{-}jinja2}

\KeywordTok{COPY}\NormalTok{ conf /conf}
\KeywordTok{COPY}\NormalTok{ start.py /start.py}

\KeywordTok{CMD}\NormalTok{ /start.py}
\end{Highlighting}
\end{Shaded}

\hypertarget{archlinux}{%
\subsection{Archlinux}\label{archlinux}}

Installing \textbf{Apache Web Server}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{pacman}\NormalTok{ {-}Syu apache}
\end{Highlighting}
\end{Shaded}

Configuring the \textbf{Common Gateway Interface} for the web server in
\texttt{httpd.conf}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{vim}\NormalTok{ /etc/httpd/conf/httpd.conf}
\end{Highlighting}
\end{Shaded}

And add these two lines to enable CGI scripts under the directory
\texttt{/srv/http/cgi-bin}, so it changes from this

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\textless{}Directory}\AttributeTok{ "/srv/http/cgi{-}bin"}\FunctionTok{\textgreater{}}
    \ExtensionTok{AllowOverride}\CharTok{ }\KeywordTok{None}
    \ExtensionTok{Options}\CharTok{ }\KeywordTok{None}
\NormalTok{    Require}\StringTok{ all granted}
\NormalTok{+   }\ExtensionTok{Options}\CharTok{ }\KeywordTok{+ExecCGI}
\NormalTok{+   AddHandler}\StringTok{ cgi{-}script .cgi}
\FunctionTok{\textless{}/Directory\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{sec:test}{%
\section{SECTION 3 : Testing}\label{sec:test}}

\hypertarget{chapter-6-findings}{%
\chapter{CHAPTER 6 : Findings}\label{chapter-6-findings}}

\hypertarget{findings}{%
\section{Findings}\label{findings}}

This CHAPTER is going to be a recap of what we've discussed throughout
this paper :

\begin{itemize}
\tightlist
\item
  Containerization is an operating system level virtualizaion.
\item
  Simulation is deeper then emulation.
\item
  Containers require isolation, preferably on multiple layers.
\item
  Under Linux Qemu/kvm provides a relatively secure virtual environment.
\item
  Linux virtualizaion stack relay on multiple complementary
  technologies, Qemu/kvm, libvirt, libguestfs.
\item
  Using a Mandatory Access Control framework is a key element to a
  secure system overall \& containerization.
\item
\end{itemize}

\hypertarget{conclusions}{%
\section{Conclusions}\label{conclusions}}

At the end of this paper it's clear how important to make sure that your
containerization infrastructure is as secure as possible by using the
techniques described earlier, these kinds of counter measures not only
saves the companies running the micro services but extends to the
generally unaware client from falling into the hackers trapped container
thus preventing a whole category of cyber crimes.

\hypertarget{bibliography}{%
\section{Bibliography}\label{bibliography}}

\hypertarget{resources-and-references}{%
\chapter{resources and references}\label{resources-and-references}}

\end{document}
